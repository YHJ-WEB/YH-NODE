function alert(t){return!1}function resizeTextarea(t,e){var a=navigator.userAgent.toLowerCase(),r=a.indexOf("opera")!=-1,o=a.indexOf("msie")!=-1&&document.all&&!r;if(t){e||(e=1);var n=t.value.split("\n"),s=o?1:0;s+=n.length;var l=t.cols;l<=20&&(l=40);for(var i=0;i<n.length;i++)n[i].length>=l&&(s+=Math.ceil(n[i].length/l));s=Math.max(s,e)+1,console.log(s),s!=t.rows&&(t.rows=s-1)}}Array.prototype.remove=function(t){if(isNaN(t)||t>this.length)return!1;for(var e=0,a=0;e<this.length;e++)this[e]!=this[t]&&(this[a++]=this[e]);this.length-=1},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},$(".triggerInputWarp").on("click",".triggerInput",function(){console.log("triggerInput"),$(this).find("input").focus(),console.log("$(this).find(nput)"),console.log($(this).find("input"))});var appStoreName="测试",app=angular.module("YHZS",["ui.router"]),myChatInfo=void 0;localStorage.getMyChatInfo&&(myChatInfo=JSON.parse(localStorage.getMyChatInfo).date);var imChatType=void 0;mui.init({keyEventBind:{backbutton:!0}}),app.filter("andFilter",["$$log",function(t){return function(e,a){function r(t){for(var e=0;e<o.length;e++)if(JSON.stringify(t).indexOf(o[e])<0)return 0;n.push(t)}if(!a)return e;t.log(e),t.log(a);for(var o=a.split(" "),n=[],s=0;s<e.length;s++)r(e[s]);return t.log(n),n}}]),app.factory("$$color",["$$log",function(t){return{transform:function(t){var e=t;switch(t){case"bkColor1":case"color1":case void 0:case"":e="orange";break;case"bkColor2":case"color2":e="blue";break;case"bkColor3":case"color3":e="purple";break;case"bkColor4":case"color4":e="pink";break;case"bkColor5":case"color5":e="orange";break;case"bkColor6":case"color6":e="red";break;case"bkColor7":case"color7":case"bkColor8":case"color8":e="yellow"}return e},getColor:function(){var t=[{className:"pink",nickName:"粉色"},{className:"green",nickName:"绿色"},{className:"lightGreen",nickName:"浅绿色"},{className:"darkGreen",nickName:"深绿色"},{className:"orange",nickName:"橙色"},{className:"water",nickName:"水色"},{className:"yellow",nickName:"黄色"},{className:"lightGray",nickName:"浅灰色"},{className:"lightBlue",nickName:"浅蓝色"},{className:"blue",nickName:"蓝色"},{className:"red",nickName:"红色"},{classNam:"purple",nickName:"紫色"}];return t}}}]),app.factory("$$env",function(){var t=0;return{setEnvirement:function(e){switch(e){case"app":t=101;break;case"pro":t=2;break;case"dev":t=1;break;case"debug":t=3}},getEnvirement:function(){return t}}}),app.factory("$$getClientInfo",["$$env","$$toast","$$log",function(t,e,a){var r={appod:"test",appkey:"test",token:"test",clientid:"test"};if(localStorage.getEnvirement=t.getEnvirement(),0==t.getEnvirement())return r;try{return a.debug("$$getClientInfo"),a.info(JSON.stringify(plus.push.getClientInfo())),plus.push.getClientInfo()}catch(o){return r}}]),app.factory("$$getUserAgent",function(){return{versions:function(){var t=navigator.userAgent;this.u=t;navigator.appVersion;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/)||t.indexOf("Android")>-1||t.indexOf("iPhone")>-1||t.indexOf("iPad")>-1||"micromessenger"==t.match(/MicroMessenger/i),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,weixin:t.indexOf("micromessenger")>-1||t.indexOf("MicroMessenger")>-1,all:t}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()}}),app.factory("$$iconfont",["$$env",function(t){return{init:function(e){return t.getEnvirement()>0&&(e=e.replace("&#x",""),e=e.replace(";",""),e=String.fromCharCode(parseInt(e,16))),e}}}]),app.factory("$$initRem",["$$log",function(t){return{init:function(){function e(){var e=$("html").width();$("body,html").css("font-size",e/16+"px"),t.debug("$$initRem.resizeHtmlFont")}e(),addEventListener("orientationchange",function(t){e(),t.preventDefault()}),addEventListener("resize",function(t){e(),t.preventDefault()}),$(document).ready(function(){e()})},getSize:function(){return $("html").width()/16}}}]),app.factory("$$log",["$log","$$env",function(t,e){var a=!1,r=!1;return{showAll:function(t){a=t||!0},hideAll:function(t){r=t||!0},log:function(o,n){n=n?n:1,!r&&(a||e.getEnvirement()<=n)&&t.log(o)},info:function(o,n){n=n?n:1,!r&&(a||e.getEnvirement()<=n)&&t.info(o)},warn:function(o,n){n=n?n:1,!r&&(a||e.getEnvirement()<=n)&&t.warn(o)},error:function(o,n){n=n?n:3,!r&&(a||e.getEnvirement()<=n)&&t.error(o)},debug:function(o,n){n=n?n:1,!r&&(a||e.getEnvirement()<=n)&&t.debug(o)}}}]),app.factory("$$navbar",["$$log","$rootScope",function(t,e){return{show:function(){e.$emit("setNavbarShow",!0),t.debug(e.setNavbarShow),t.debug("$$navbar.hide")},hide:function(){e.$emit("setNavbarShow",!1),t.debug(e.setNavbarShow),t.debug("$$navbar.hide")},showReturnBtn:function(){e.$emit("setNavbarReturnBtnShow",!0),t.debug("$$navbar.showReturnBtn")},hideReturnBtn:function(){e.$emit("setNavbarReturnBtnShow",!1),t.debug("$$navbar.hideReturnBtn")},setTitle:function(a){e.$emit("setNavbarTitle",a),t.info(a)},setRightBtnShow:function(a,r){e.$emit("setRightBtnShow",!0);var o="";switch(a){case 1:e.$emit("setRightIconBtn",!0),o="setRightIconBtn";break;case 2:e.$emit("setRightAddTagBtn",!0);break;case 3:e.$emit("setRightTextBtn",r),o="setRightTextBtn"}t.debug("$$navbar.showRightQRbtnshowstyle:"+o)},hideRightQRbtn:function(){e.$emit("setRightBtnShow",!1),t.debug("$$navbar.hideRightQRbtn")}}}]),app.filter("orFilter",["$$log",function(t){return function(e,a){if(!a)return e;t.log(e),t.log(a);for(var r=a.split(" "),o=[],n=0;n<e.length;n++){for(var s=0,l=0;l<r.length;l++)JSON.stringify(e[n]).split(r[l]).length>1&&s++;s>0&&o.push(e[n])}return t.log(o),o}}]),app.factory("$$patientFilter",function(){return{getpatient:function(t){var e=parseInt(localStorage.authorizedStatus);if(4==e||5==e){$$log.debug("nurseType == 4");for(var a=0;a<t.length;a++)for(var r=0;r<t[a].member.length;r++)if("undefined"!=typeof t[a].member[r].tag)for(var o=0;o<t[a].member[r].tag.length;o++){if(3==t[a].member[r].tag[o].tagType){t[a].member[r].isBlack=!0;break}t[a].member[r].isBlack=!1}else t[a].member[r].isBlack=!1;for(var a=0;a<t.length;a++)t[a].isNull=!1;for(var a=0;a<t.length;a++)for(var r=0;r<t[a].member.length;r++){var n=1;1==t[a].member[r].isBlack&&(n+=1,n==t[a].member.length==n&&(t[a].isNull=!0))}return t}return t}}}),app.factory("$$requestUrl",["$$env","$$log","$$shence",function(t,e,a){var r="",o="json/",n="http://api.zhushou.test.youhujia.com/",s="http://api.zhushou.youhujia.com/",l={demo:"yh/{id1}/{id2}/demo",startFollowUpStateController:"api/nurses/followup/pages",startFollowUpChat:"api/nurses/msg/im/{fromId}/to-user/{toId}",createFollowUpTemplatesStateController:"api/nurses/followup/pages/templates",chooseFollowUpTemplatesStateController:"api/nurses/followup/pages/templates",updateTemplate:"api/nurses/followup/pages/templates/{id}",getFollowUpRecord:"api/nurses/calendars/events/followup/{id}",updateFollowUpRecord:"api/nurses/calendars/events/followup/{id}",setChatFollowUp:"api/nurses/msg/im/{fromId}/to-user/{toId}",weiXinPushFollow:"api/nurses/msg/wx-template-msg/followup",followMsg:"api/nurses/wx-template-msg/followup",chooseRemindTimeStateController:"api/nurses/followup/pages/templates/alerts",changeScheduleClassStateController:"api/nurses/rosters/departments/{departmentId}",changeSchedulePersonStateController:"api/nurses/rosters/departments/{departmentId}/by-person",batchSchedulesStateController:"api/nurses/rosters/departments/{departmentId}/by-person",dropSchedule:"api/nurses/rosters/schedules/{rosterScheduleIds}",createSchedule:"api/nurses/rosters/schedules/append",dropSortSchedule:"api/nurses/rosters/schedules/{rosterScheduleIds}",createSortScheduleStateController:"api/nurses/rosters/schedules/batch-append",createNurseScheduleStateController:"api/nurses/rosters",updateNurseSchedule:"api/nurses/rosters/{rosterId}",chooseNurseScheduleStateController:"api/nurses/rosters",NurseScheduleListStateController:"api/nurses/rosters",nursePlanCounterStateController:"api/ns/planCount",nurseToolCounterStateController:"api/ns/toolCount",signOut:"api/nurses/signout",signIn:"api/nurses/signup/phone",createInviteNurse:"api/nurses/{nurseId}/invite-via-sms",contentListStateController:"api/nurses/cms-content",createDeviceClient:"api/nurses/msg/push/client-infos",userCenterInfoStateController:"api/nurses/{nurseId}/info",getLoginPhoneCaptcha:"api/nurses/signup/phone-captcha",getAlertPhoneCaptcha:"api/nurses/signup/phone-captcha",createBasicInfo:"api/nurses/{nurseId}/info",createProfessionInfo:"api/nurses/{nurseId}/info",alterNurseInfoStateController:"api/nurses/{nurseId}/info",updateNurseInfo:"api/nurses/{nurseId}/info",choiceHospitalStateController:"api/departments",createHospital:"api/organizations",choiceDepartmentStateController:"api/departments",createDepartment:"api/departments",allPatientListStateController:"api/nurses/{nurseId}/patients",otherPatientListStateController:"api/nurses/{nurseId}/patients",nurseListStateController:"api/nurses/{nurseId}/colleagues",nurseDetailStateController:"api/nurses/{nurseId}/colleagues",patientDetailStateController:"api/nurses/users/{userId}/info",patientTagStateController:"api/departments/{departmentId}/tags/users",alterNurseTagStateController:"api/departments/{departmentId}/tags/nurses",createNurseTag:"api/nurses/tags",updateNurseTags:"api/nurses/{nurseId}/tags",createPatientTagCategory:"api/nurses/users/tags",createPatientCategoryTag:"api/nurses/users/tags",updatePatientTag:"api/nurses/users/{userId}/tags",getSelectNurseStateController:"api/nurses/{nurseId}/colleagues",getSelectPatientStateController:"api/nurses/{nurseId}/patients",getTagPatientList:"api/nurses/{nurseId}/patients",createPatientChat:"api/nurses/msg/im/{fromId}/to-user/{toId}",createNurseChat:"api/nurses/msg/im/{fromId}/to-nurse/{toId}",createPatientsWeiXinPush:"api/nurses/msg/new-im",patientTagManageStateController:"api/departments/{departmentId}/tags/users",nurseTagManageStateController:"api/departments/{departmentId}/tags/nurses",deleteNurseTag:"api/nurses/tags/delete",updateNurseTag:"api/nurses/tags",deletePatientTag:"api/nurses/users/tags/delete",updateDepartmentPatientTag:"api/nurses/users/tags",createNurseTagInManage:"api/nurses/tags",createPatientCategoryTagInManage:"api/nurses/users/tags",createPatientTagCategoryInManage:"api/nurses/users/tags",attentionTagStateController:"api/nurses/users/{nurseId}/tags",blackListTagStateController:"api/nurses/users/{nurseId}/tags",allDepartmentTags:"api/departments/{departmentId}/tags/nurses",removeBlackList:"api/nurses/users/bulk/tags",blackList:"api/nurses/{nurseId}/patients/blacklist",messageTagStateController:"api/nurses/calendars/messagePage",recentCalenderStateController:"api/nurses/calendars/messagePage",getMyChatInfo:"api/nurses/msg/im/me",createGroupChat:"api/nurses/msg/im/group-chats",createC2CNurse:"api/nurses/msg/im/{fromId}/to-nurse/{toId}",createC2CUser:"api/nurses/msg/im/{fromId}/to-user/{toId}",statisticStateController:"api/nurses/metadata/shence",planCountStateController:"api/nurses/metadata/plan",toolCountStateController:"api/nurses/metadata/tool"};return{getUrl:function(i,c){switch(t.getEnvirement()){case 100:case 101:r=s;break;case 2:r=s;break;case 1:r=o;break;case 0:r=n;break;case 3:r=n;break;default:r=s}var u=r+l[i]+(0===t.getEnvirement()?".json":"");for(var d in c)u=u.replace("{"+d+"}",0===t.getEnvirement()?d:c[d]);return e.debug("requestUrl.getUrl:"+i),u.split("{").length>1&&e.warn("please check params"),e.info(u),a.track("_"+i),u}}}]),app.factory("$$title",["$$getUserAgent","$timeout","$$log","$$navbar",function(t,e,a,r){return{setTitle:function(o){var n=$("body");if(document.title=o,r.setTitle(o),t.versions.weixin||t.mobile)var s=$('<iframe style="display: none" src="/favicon.ico"></iframe>').on("load",function(){e(function(){s.remove(),a.debug("$$title.setTitle.removeIframe")},100)}).appendTo(n);a.debug("$$title.setTitle")}}}]),app.factory("$$shence",["$$log","$$env",function(t,e){return{init:function(){!function(t){var e=t.sdk_url,a=t.name,r=window,o=document,n="script",s=null,l=null;r.sensorsDataAnalytic201505=a,r[a]=r[a]||function(t){return function(){(r[a]._q=r[a]._q||[]).push([t,arguments])}};for(var i=["track","quick","register","registerPage","registerOnce","registerSession","registerSessionOnce","trackSignup","trackAbtest","setProfile","setOnceProfile","appendProfile","incrementProfile","deleteProfile","unsetProfile","identify"],c=0;c<i.length;c++)r[a][i[c]]=r[a].call(null,i[c]);r[a]._t||(s=o.createElement(n),l=o.getElementsByTagName(n)[0],s.async=1,s.src=e,l.parentNode.insertBefore(s,l),r[a]._t=1*new Date,r[a].para=t)}({sdk_url:"js/lib/sensorsdata.min.js ",name:"sa",server_url:"http://123.56.231.188:8006/sa?project=yhzs_nurse"})},identify:function(e,a){void 0!==sa?(t.debug("shence.identify"),t.info(e),t.info(a),sa.identify(e,a)):t.error("shence is not loaded")},track:function(e,a){void 0!==sa?(a=a||{},a.departmentId=localStorage.globalDepartmentId,a.hospitalId=localStorage.hospitalId,a.department=localStorage.department,a.hospital=localStorage.hospital,a.phone=localStorage.phone,a.appStoreName=appStoreName,t.debug("shence.track"),t.info(e),localStorage.globalNurseId&&sa.identify(localStorage.globalNurseId),sa.track(e,a),sa.quick("autoTrack")):t.error("shence is not loaded")}}}]),app.factory("$$timestampMarker",["$$requestUrl","$$log","$location","$q","$injector","$$env","$$toast","$timeout",function(t,e,a,r,o,n,s,l){return{request:function(t){return t.requestTimestamp=(new Date).getTime(),t.headers.Authorization=localStorage.token||"empty",t.headers.Accept="application/json",t.headers["Access-Control-Allow-Origin"]="*",t.headers["Access-Control-Allow-Methods"]="GET, POST, PUT, DELETE, OPTIONS",t.headers["Access-Control-Allow-Headers"]="X-Requested-With",t.headers["Content-Type"]="application/json",e.debug("requestSend"),e.info(t),t},responseError:function(t){e.debug("responseError"),e.debug(t),500==t.status&&s.show("服务器错误")},response:function(t){return console.log(t),t.data.result&&0==t.data.result.success&&void 0===t.data.result.displaymsg&&(t.data.result.displaymsg=t.data.result.displayMsg),t.data.result&&0==t.data.result.success&&void 0===t.data.result.displayMsg&&(t.data.result.displayMsg=t.data.result.displaymsg),!t.data.result||0!=t.data.result.success&&"false"!=t.data.result.success||401!=t.data.result.code||(localStorage.clear(),localStorage.guided="true",l(function(){location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/login"},1e3),location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/login"),!t.data.result||0!=t.data.result.success&&"false"!=t.data.result.success||403!=t.data.result.code?t.data.result&&0==t.data.result.success&&t.data.result.code>1e4&&s.show(t.data.result.displayMsg):(s.show(t.data.result.displayMsg,function(){}),location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/userCenter"),t.config.responseTimestamp=(new Date).getTime(),t}}}]);var selSess={},targetArray=[],eleArray=[];app.factory("$$txIM",["$$log","$$toast","$http","$$requestUrl","$$tabbar","$$title","$$env","$timeout",function(t,e,a,r,o,n,s,l){var i=1400013584,c=6943,u=!0,d=!1,g="./img/title.png",p={},m="!-!Alpha!-!",f="!-!Beta!-!",h="!-!Gamma!-!",$=0,b="",S="";return{login:function(e,o,n){function m(){function a(){webim.login(p,s,r,function(e){t.debug("$$txIM.login.success"),t.info(e),o(e)},function(e){t.error("$$txIM.login.error"),t.error(e),n(e),l(function(){m()},2e3)})}selSess={},e=e||{},o=o||function(t){},n=n||function(t){};var r={isAccessFormalEnv:u,isLogOn:d};p={sdkAppID:i,accountType:c,identifier:myChatInfo.id,userSig:myChatInfo.sig,headurl:myChatInfo.userHead||g};var s={onConnNotify:function(a){t.debug("$$txIM.onConnNotify"),t.info(a);var r;switch(a.ErrorCode){case webim.CONNECTION_STATUS.ON:webim.Log.warn("建立连接成功: "+a.ErrorInfo);break;case webim.CONNECTION_STATUS.OFF:r="连接已断开，无法收到新消息，请检查下你的网络是否正常: "+a.ErrorInfo,webim.Log.warn(r);break;case webim.CONNECTION_STATUS.RECONNECT:r="连接状态恢复正常: "+a.ErrorInfo,webim.Log.warn(r);break;default:webim.Log.error("未知连接状态: ="+a.ErrorInfo)}e.onConnNotify&&e.onConnNotify(a)},onMsgNotify:function(a){t.debug("$$txIM.onMsgNotify"),t.info(a),e.onMsgNotify&&e.onMsgNotify(a)}};t.debug("$$txIM.login"),webim.logout(function(){a()},function(t){S.login(e,o,n)})}return!(s.getEnvirement()<1)&&(S=this,localStorage.getMyChatInfo&&+new Date-+JSON.parse(localStorage.getMyChatInfo).time<36e5&&(myChatInfo=JSON.parse(localStorage.getMyChatInfo).date),void(void 0!==myChatInfo&&myChatInfo!={}&&""!=myChatInfo.id&&void 0!=myChatInfo.id?m():a({method:"GET",url:r.getUrl("getMyChatInfo"),params:{}}).success(function(e){t.debug("getMyChatInfo"),t.info(e),myChatInfo={id:e.identifier,sig:e.signature,userHead:e.avatarUrl,nickName:e.nickname},void 0!=myChatInfo.id&&""!=myChatInfo.id?(localStorage.myChatId=myChatInfo.id,localStorage.getMyChatInfo=JSON.stringify({time:+new Date,date:myChatInfo}),m()):history.go(-1)}).error(function(t){m()})))},loadList:function(){for(var t=void 0!==localStorage.chatList?JSON.parse(localStorage.chatList):[],e=0;e<t.length;e++){var a=this.loadLastMsg(t[e].chatId);"empty"!=a.type&&t[e].lastMsg.fullTime<=a.fullTime&&(t[e].lastMsg=a)}return t},checkIMArray:function(){return localStorage.imSendArray?JSON.parse(localStorage.imSendArray):(localStorage.imSendArray=JSON.stringify([]),[])},pushIMArray:function(t,e){var a=this.checkIMArray();a.push(e+m+JSON.stringify(t)),localStorage.imSendArray=JSON.stringify(a)},sendIMArray:function(e,a){for(var r=this.checkIMArray(),o=this,n=[],s=0,l=[],i=[],c=0;c<r.length;c++)n=r[c].split(m),function(c,u){o.sendElementMsg(JSON.parse(n[1]),n[0],function(o){if(i.push(o),S.saveLastMsgWithId(S.createMsgEle(o,!1),u),s++,l.push(c),s>=r.length){for(var n=[],d=0;d<r.length;d++)l.indexOf(d)<0&&n.push(r[d]);localStorage.imSendArray=JSON.stringify(n),n.length>0?(t.error("sendIMArray error"),t.info(n)):t.debug("sendIMArray success"),e&&0===n.length?e(i):a&&n.length>0&&a()}})}(c,n[0])},initImArrayAndSend:function(t,e,a){for(var r=0;r<t.length;r++)for(var o=0;o<e.length;o++)this.pushIMArray(e[o],t[r]);1==a||this.sendIMArray()},sendElementMsg:function(t,e,a,r,o){var n="!-!Beta!-!",s="!-!Gamma!-!",l=t.type+n+(t.id||"")+s+(t.name||"")+s+(t.desc||"")+s+(t.img||"");this.sendTextMsg(l,e,a,r,o)},sendTextMsg:function(e,a,r,o,n){if(t.debug("$$txIM.sendTextMsg"),t.info(e),e.length<1)return o(),!1;var s,l,i;if(l=webim.Tool.getStrBytes(e),s=a.indexOf("@")<0?webim.MSG_MAX_LENGTH.C2C:webim.MSG_MAX_LENGTH.GROUP,i="消息长度超出限制(最多"+Math.round(s/3)+"汉字)",l>s)return!1;selSess[a]||(selSess[a]=new webim.Session(a.indexOf("@")<0?webim.SESSION_TYPE.C2C:webim.SESSION_TYPE.GROUP,a,a,p.headurl,Math.round((new Date).getTime()/1e3)));var c=!0,u=-1,d=Math.round(4294967296*Math.random()),g=Math.round((new Date).getTime()/1e3),h=0,$=new webim.Msg(selSess[a],c,u,d,g,p.identifier,h,p.identifierNick),b=(e.indexOf(f)>=0?e:"text"+f+e)+m+myChatInfo.userHead+m+myChatInfo.nickName,S=new webim.Msg.Elem.Text(b);$.addText(S),webim.sendMsg($,function(e){t.debug("$$txIM.sendMsg.success"),t.info(e),r&&r($),o&&o($)},function(e){t.error("$$txIM.sendMsg.err"),t.error(e),o&&o($),n&&n(e)})},getGroupInfo:function(e,a,r){var o={GroupIdList:[e],GroupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption"],MemberInfoFilter:["Account","Role","JoinTime","LastSendMsgTime","ShutUpUntil"]};webim.getGroupInfo(o,function(e){t.debug("$$txIM.getGroupInfo"),t.info(e),a&&a(e)},function(t){alert(t.ErrorInfo)})},setRead:function(t){selSess[t]||(selSess[t]=new webim.Session(t.indexOf("@")<0?webim.SESSION_TYPE.C2C:webim.SESSION_TYPE.GROUP,t,t,p.headurl,Math.round((new Date).getTime()/1e3))),webim.setAutoRead(selSess[t],!0,!0)},getHistoryMsgs:function(e,a){if(localStorage.targetChatId.indexOf("@")<0){t.debug("getC2CHistoryMsgs");var r={Peer_Account:localStorage.targetChatId,MaxCnt:15,LastMsgTime:$,MsgKey:b};webim.getC2CHistoryMsgs(r,function(a){t.debug("$$txIM.getC2CHistoryMsgs.success"),t.info(a),$[localStorage.targetChatId]=a.LastMsgTime,b[localStorage.targetChatId]=a.MsgKey,e(a.MsgList)},function(e){t.error("$$txIM.getC2CHistoryMsgs.error"),t.error(e),a&&a(e)})}else t.debug("getGroupHistoryMsgs"),this.getGroupInfo(localStorage.targetChatId,function(r){var o={GroupId:localStorage.targetChatId,ReqMsgSeq:r.GroupInfo[0].NextMsgSeq-1>0?r.GroupInfo[0].NextMsgSeq-1:0,ReqMsgNumber:80};n.setTitle(r.GroupInfo[0].Name+"("+r.GroupInfo[0].MemberNum+")"),webim.syncGroupMsgs(o,function(a){t.debug("$$txIM.getGroupHistoryMsgs.success"),t.debug(a),e(a)},function(e){alert(e.ErrorInfo),t.error("$$txIM.getGroupHistoryMsgs.error"),t.error(e),a&&a(e)})})},syncC2CMsgs:function(e){t.debug("$$txIM.syncMsg!"),webim.syncMsgs(function(a){t.debug("$$txIM.syncMsg"),t.info(a),e&&e(a)})},syncGROUPLastMsgs:function(e,a){this.getGroupInfo(e,function(r){var o={GroupId:e,ReqMsgSeq:r.GroupInfo[0].NextMsgSeq-1>0?r.GroupInfo[0].NextMsgSeq-1:0,ReqMsgNumber:1};webim.syncGroupMsgs(o,function(e){t.debug("$$txIM.syncGROUPMsgs.success"),t.info(e),a&&a(e)})})},saveLastMsg:function(e){t.debug("$$txIM.saveLastMsg"),t.info(JSON.stringify(e)),localStorage[myChatInfo.id+":lastChatMsg:"+localStorage.targetChatId]=JSON.stringify(e)},saveLastMsgWithId:function(e,a){t.debug("$$txIM.saveLastMsgWithId"),t.info(JSON.stringify(e)),localStorage[myChatInfo.id+":lastChatMsg:"+a]=JSON.stringify(e)},loadLastMsg:function(t){return JSON.parse(localStorage[localStorage.myChatId+":lastChatMsg:"+t]||'{"type": "empty","newMsg":false}')},markReadLastMsg:function(t){var e=this.loadLastMsg(t);e.newMsg=!1,this.saveLastMsg(e)},createMsgEle:function(e,a){var r={};return!(!e.elems||0===e.elems.length)&&(!(void 0===e.elems[0].content.text||e.elems[0].content.text.indexOf(m)<0||e.elems[0].content.text.indexOf(f)<0)&&(this.updateLastMsgTime(e.time),"text"==e.elems[0].content.text.split(m)[0].split(f)[0]?(r={type:e.elems[0].content.text.split(m)[0].split(f)[0]||"text",msg:e.elems[0].content.text.split(m)[0].split(f)[1]||e.elems[0].content.text.split(m)[0]||" ",fromAccount:e.fromAccount,fromNickName:e.elems[0].content.text.split(m)[2]||e.fromAccountNick||e.fromNickName,userHead:e.elems[0].content.text.split(m)[1]||" ",time:new Date(1e3*e.time).format("MM-dd hh:mm:ss"),fullTime:e.time,sessId:e.sess._impl.id,sessName:e.sess._impl.name,newMsg:a!==!1,unread:e.sess._impl.unread},t.debug("$$txIM.createMsgEle.typeText")):(r={type:e.elems[0].content.text.split(m)[0].split(f)[0],msg:e.elems[0].content.text.split(m)[0].split(f)[1].split(h)||[],fromAccount:e.fromAccount,fromNickName:e.elems[0].content.text.split(m)[2]||e.fromNickName||e.fromAccountNick,userHead:e.elems[0].content.text.split(m)[1]||" ",time:new Date(1e3*e.time).format("MM-dd hh:mm:ss"),fullTime:e.time,sessId:e.sess._impl.id,sessName:e.sess._impl.name,newMsg:a!==!1,unread:e.sess._impl.unread},t.debug("$$txIM.createMsgEle.typeOther")),t.info(r),r))},updateLastMsgTime:function(t){$&&($=t<$?t:$)},updateGroupInfo:function(a,r,o,n){if(webim.Tool.getStrBytes(r)>30)return e.show("群组名称最长10个汉字"),!1;if(0==r.trim().length)return e.show("群组名称不能为空"),!1;var s={GroupId:a,Name:r};webim.modifyGroupBaseInfo(s,function(e){t.debug("$$txIM.updateGroupInfo.success"),t.info(e),o&&o(e)},function(e){t.error("$$txIM.updateGroupInfo.error"),t.info(e),n&&n(e)})},syncC2CMsg:function(t){t&&t()},getAllGroup:function(e,a){var r={Member_Account:p.identifier,Limit:9999,Offset:0,GroupBaseInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption"],SelfInfoFilter:["Role","JoinTime","MsgFlag","UnreadMsgNum"]};webim.getJoinedGroupListHigh(r,function(a){t.debug("$$txIM.getAllGroup.success"),t.info(a),e&&e(a)},function(e){t.error("$$txIM.getAllGroup.error"),t.info(e),a&&a()})},getC2CInfo:function(e,a,r){var o=["Tag_Profile_IM_Nick","Tag_Profile_IM_Gender","Tag_Profile_IM_AllowType","Tag_Profile_IM_Image"],n={To_Account:e,LastStandardSequence:0,TagList:o};webim.getProfilePortrait(n,function(e){t.debug("$$txIM.getC2CInfo.success"),t.info(e),a&&a(e)},function(e){t.error("$$txIM.getC2CInfo.error"),t.info(e),r&&r(e)})},getAllFriend:function(e,a){var r={From_Account:myChatInfo.id,TimeStamp:0,StartIndex:0,GetCount:9999,LastStandardSequence:0,TagList:["Tag_Profile_IM_Nick","Tag_SNS_IM_Remark"]};webim.getAllFriend(r,function(a){t.debug("$$txIM.getAllFriend.success"),t.info(a),e&&e(a)},function(e){t.error("$$txIM.getAllFriend.error"),t.info(e),a&&a()})}}}]),app.factory("$$wx",["$http","$rootScope","$$requestUrl","$$log","$location",function(t,e,a,r,o){var n={timestamp:0},s=[];return{getDepartment:function(){return r.debug("$$wx.getDepartment"),r.info(department),department},configByHttp:function(e){t({method:"GET",url:a.getUrl("wxInit"),cache:!1,params:{url:o.absUrl()}}).success(function(t){wx.config({appId:t.appId,timestamp:t.timestamp,nonceStr:t.nonceStr,signature:t.signature,debug:!1,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","scanQRCode","chooseWXPay"]}),r.debug("$$wx.configByHttp"),r.info(t.data),e(t.data)})},config:function(t){return wx.config(t),s=[],this},getPayInfoByHttp:function(a){e.$emit("loadingShow"),t({method:"GET",url:"/user/pay/wechat-pay-info",params:{generalOrderId:a}}).success(function(t){e.$emit("loadingHide"),n={appId:t.appId,timestamp:t.timeStamp,nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign,success:function(t){e.$emit("toastShow","支付成功",function(){location.href="#/orderList"})},fail:function(t){e.$emit("toastShow","支付失败",function(){location.reload()})}}})},setPayInfo:function(t){return n=t,this},payAction:function(t){return n.timestamp>0?wx.chooseWXPay({timestamp:n.timestamp,nonceStr:n.nonceStr,"package":n["package"],signType:n.signType,paySign:n.paySign,success:function(e){t()},fail:function(t){}}):e.$emit("toastShow","获取订单信息出错",function(){location.reload()}),this},setShare:function(t){var e=function(){wx.showOptionMenu(),wx.onMenuShareAppMessage(t),wx.onMenuShareTimeline(t),wx.onMenuShareQQ(t),wx.onMenuShareWeibo(t),wx.onMenuShareQZone(t)};return e(),wx.ready(function(){e()}),s.push(e),this},runReady:function(){return wx.ready(function(){for(var t=0;t<s.length;t++)s[t]();s=[]}),this}}}]),app.directive("confirmController",function(){return{restrict:"AE",templateUrl:"templates/common/confirmController.html",replace:!0,scope:{},controller:["$rootScope","$timeout","$sce","$scope","$$log",function(t,e,a,r,o){var n=200;r.showBlock=!1,r.msg="",r.hideAnimate=!1,r.title="",r.cancelContent="取消",r.confirmContent="确定",r.btnConfirmCallback=null,r.btnConfirm=function(){o.log("confirmController.btnConfirm"),t.$emit("confirmHide",r.btnConfirmCallback)},r.btnCancel=function(){o.log("confirmController.btnCancel"),t.$emit("confirmHide",function(){})},t.$on("confirmShow",function(t,e){e.title&&e.msg&&e.callback?(r.title=e.title,r.msg=a.trustAsHtml(e.msg),r.btnConfirmCallback=e.callback,r.cancelText=e.cancelText?e.cancelText:"取消",r.confirmText=e.confirmText?e.confirmText:"确定",r.showBlock=!0):o.error("confirmShow option error")}),t.$on("confirmHide",function(t,a){r.hideAnimate=!0,e(function(){r.showBlock=!1,r.hideAnimate=!1,r.msg="",e(function(){r.$apply()}),a()},n)})}]}}),app.factory("$$confirm",["$$log","$rootScope",function(t,e){return{show:function(a){e.$emit("confirmShow",a),t.debug("$$confirm.show"),t.info(a)}}}]),app.directive("loadingController",function(){return{restrict:"AE",templateUrl:"templates/common/loadingController.html",replace:!0,scope:{},controller:["$rootScope","$timeout","$sce","$scope","$$log",function(t,e,a,r,o){r.showBlock=!1,r.msg="",r.hideAnimate=!1,t.$on("loadingShow",function(t){r.showBlock=!0,e(function(){r.$apply()})}),t.$on("loadingHide",function(t){r.showBlock=!1,e(function(){r.$apply()})})}]}}),app.factory("$$loading",["$$log","$rootScope",function(t,e){return{show:function(){e.$emit("loadingShow"),t.debug("$$loading.show")},hide:function(){e.$emit("loadingHide"),t.debug("$$loading.hide")}}}]),app.directive("navbarController",function(){return{restrict:"AE",templateUrl:"templates/common/navbarController.html",replace:!0,scope:{},controller:["$rootScope","$timeout","$sce","$scope","$$log","$$env",function(t,e,a,r,o,n){r.navbarShow=!0,r.returnBtnShow=!1,r.navbarContent="",r.rightBtnShow=!1,r.QRbtn=!1,r.addTagBtn=!1,r.addBtn=!1,r.textBtn="",r.returnBtnClick=function(){o.debug("navbarController.returnBtnClick"),history.go(-1)},t.$on("setNavbarShow",function(t,e){o.debug(e),r.navbarShow=e}),t.$on("setNavbarReturnBtnShow",function(t,e){r.returnBtnShow=e}),t.$on("setNavbarTitle",function(t,a){r.navbarTitle=a,e(function(){r.$apply()})}),t.$on("setRightBtnShow",function(t,e){r.rightBtnShow=e}),t.$on("setRightIconBtn",function(t,e){r.iconNum=e}),t.$on("setRightAddTagBtn",function(t,e){r.addTagBtn=e}),t.$on("setRightTextBtn",function(t,e){r.textBtn=e}),r.goMessageTag=function(){function t(t){location.href=t}o.debug("跳到首页");var e=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/messageTag";o.debug(e),t(e)}}]}}),app.directive("tabbarController",function(){return{restrict:"AE",templateUrl:"templates/common/tabbarController.html",replace:!0,scope:{active:"@active"},controller:["$$shence","$scope","$element","$attrs","$$log","$rootScope","$timeout","$state",function(t,e,a,r,o,n,s,l){e.active=e.active||0,e.newMsgsActive=[!1,!1,!1,!1],e.gotoPage=function(t){switch(t){case 0:location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/messageTag";break;case 1:"messageTag"==l.current.name?location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/show/allPatientList":l.go("allPatientList",{operateType:"show"});break;case 2:"messageTag"==l.current.name?location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/toolList":l.go("toolList");break;case 3:"messageTag"==l.current.name?location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/userCenter":l.go("userCenter")}},n.$on("tabbarChange",function(t,a){scrollTo(0,0),e.active=a,s(function(){e.$apply()}),s(function(){e.$apply()},1e3)}),n.$on("setTabbarNewMsg",function(t,a,r){e.newMsgsActive[a]=r,s(function(){e.$apply()})}),o.debug("tabbarController"),o.info(e)}]}}),app.factory("$$tabbar",["$$log","$rootScope",function(t,e){return{hide:function(){e.$emit("tabbarChange",-1)},setIndex:function(a){e.$emit("tabbarChange",a),t.debug("tabbarChange"+a)},setNewMsg:function(a,r){t.debug("setNewMsg"+a+":"+r!==!1),e.$emit("setTabbarNewMsg",a,r!==!1)}}}]),app.factory("$$toast",["$$log","$rootScope",function(t,e){return{show:function(a,r){void 0===r&&(r=function(){}),t.debug("$$toast.show"),t.info(a),t.info(r),e.$emit("toastShow",a,r)}}}]),app.directive("toastController",function(){return{restrict:"AE",templateUrl:"templates/common/toastController.html",replace:!0,scope:{},controller:["$rootScope","$timeout","$sce","$scope",function(t,e,a,r){var o=3e3;r.showBlock=!1,r.msg="",t.$on("toastShow",function(t,n,s){r.showBlock=!0,r.msg=a.trustAsHtml(n),e(function(){r.showBlock=!1,r.msg="",s&&s()},o)})}]}});var basicInfoObject={id:0,name:"",organizationId:"",organizationName:"",departmentId:"",departmentName:"",
professionalTitle:"",avatarUrl:"",phone:""},basicInfo={hospital:"",office:""};app.directive("basicInfoController",function(){return{restrict:"AE",templateUrl:"templates/controller/basicInfoController.html",replace:!0,scope:{data:"=data"},controller:["$$env","$scope","$element","$attrs","$$log","$state","$$toast","$http","$$requestUrl","$$loading","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d){function g(t){switch(t){case"hospitalObj":o.debug("hospitalObj"),o.debug(hospitalObj),e.hospitalName=hospitalObj.organizationName,e.hospitalId=hospitalObj.organizationId;break;case"departmentObj":e.departmentName=departmentObj.departmentName,e.departmentId=departmentObj.departmentId}}0===basicInfoObject.name.length||0===basicInfoObject.professionalTitle.length?(e.name="",e.professionalTitle="",e.hospitalName="",e.departmentName="",e.avatarUrl=""):(e.name=basicInfoObject.name,e.professionalTitle=basicInfoObject.professionalTitle,$("#id-1-img").attr("src",basicInfoObject.avatarUrl)),g("hospitalObj"),g("departmentObj"),e.goChoiceHospital=function(){basicInfoObject.name=e.name,basicInfoObject.professionalTitle=e.professionalTitle,basicInfoObject.avatarUrl=$("#id-1-img").attr("src"),basicInfo.hospital=!0,n.go("choiceHospital")},e.goChoiceDepartment=function(){""===e.hospitalName||void 0===e.hospitalName?s.show("请先选择所在医院"):(basicInfoObject.name=e.name,basicInfoObject.professionalTitle=e.professionalTitle,basicInfoObject.avatarUrl=$("#id-1-img").attr("src"),basicInfo.office=!0,n.go("choiceDepartment",{hospitalId:e.hospitalId}))},e.changeUserHead=function(){function a(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function r(t){var e=t.lastIndexOf(".");return t.substring(e+1)}var n=document.getElementById("id-1-file").files[0],l=document.getElementById("id-1-file").files[0].name,i=r(l),u="avatar/"+a()+"."+i;o.debug("$$env"),o.debug(t.getEnvirement());var d="",g="";1==t.getEnvirement()?(o.debug("dev 1"),d="yhjstatic-dev",g="http://yhjstatic-dev.oss-cn-shanghai.aliyuncs.com/"):2==t.getEnvirement()&&(o.debug("pro 2"),d="yhjstatic",g="http://yhjstatic.oss-cn-shanghai.aliyuncs.com/"),o.debug("bucket"+d),o.debug("ulrStr"+g);var p=new OSS.Wrapper({region:"oss-cn-shanghai",accessKeyId:"LTAICadISGBAyskk",accessKeySecret:"TSnzCdIizqqW1QdW7VxbBJYStaMeZj",bucket:d});c.show(),p.multipartUpload(u,n).then(function(t){var a=g+t.name+"?x-oss-process=image/resize,h_500";o.debug("返回的图片路径为："+a),e.headImgUrl=a,document.getElementById("id-1-img").src=a,e.avatarUrl=document.getElementById("id-1-img").src,c.hide()})["catch"](function(t){c.hide(),s.show("上传失败！请重新上传"),o.debug(t)})},$("#id-1-img").on("click",function(){var t=$(this).attr("id");console.log(t),$("#id-1-file").trigger("click")}),e.nextTwoUser=function(){e.avatarUrl=$("#id-1-img").attr("src"),o.debug("$scope.avatarUrl"+e.avatarUrl);var t=""==e.hospitalName||"undefined"==typeof e.hospitalName,a=""==e.departmentName||"undefined"==typeof e.departmentName;return o.debug("departmentName"+t),o.debug("isDepartmentNameNull"+a),""==e.name||""==e.professionalTitle||t||a?(s.show("请检查信息再提交"),!1):(basicInfoObject={id:parseInt(localStorage.globalNurseId),name:e.name,organizationId:e.hospitalId,organizationName:e.hospitalName,departmentId:e.departmentId,departmentName:e.departmentName,professionalTitle:e.professionalTitle,avatarUrl:e.avatarUrl,phone:globalNursePhone.toString()},void l({method:"PATCH",url:i.getUrl("createBasicInfo",{nurseId:localStorage.globalNurseId}),data:{basic:basicInfoObject}}).success(function(t){t.result.success===!0?(n.go("professionInfo"),o.debug("creatBasicInfo"),o.info(t),localStorage.globalDepartmentId=e.departmentId,localStorage.department=e.departmentName,localStorage.hospital=e.hospitalName,localStorage.hospitalId=e.hospitalId):s.show(t.result.displayMsg.toString()?t.result.displayMsg.toString():"服务器扔过来一个错误")}))},localStorage.globalDepartmentId=e.departmentId}]}}),app.directive("beforeRecordController",function(){return{restrict:"AE",templateUrl:"templates/controller/beforeRecordController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d){t.phone="",t.identifyCode="",t.password="",t.count=-1,r.debug("beforeRecordController"),r.info(t)}]}}),app.directive("blackListController",function(){return{restrict:"AE",templateUrl:"templates/controller/blackListController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$timeout","$$loading","$$txIM","$$toast","$http","$$requestUrl","$state","$$title","$$confirm",function(t,e,a,r,o,n,s,l,i,c,u,d,g){t.blackListTagId=[],t.patientBlackList=[];for(var p=0;p<t.data.user.length;p++){for(var m=[],f=0;f<t.data.user[p].member.length;f++)if(void 0!==t.data.user[p].member[f].tag)for(var h=0;h<t.data.user[p].member[f].tag.length;h++)if(3==t.data.user[p].member[f].tag[h].tagType){m.push(t.data.user[p].member[f]);break}t.patientBlackList.push({member:m,title:t.data.user[p].title})}t.patientBlackList=t.patientBlackList.filter(function(t){return t.member.length>0&&"特别关注"!=t.title}),t.onEditClick=function(){t.patientBlackList.length>0&&(t.isEdit=!0)},t.onCheckSelfClick=function(e,a){t.isEdit===!0&&(a.sel=!a.sel)},t.onRemovePatientClick=function(e){t.isEdit=!1;for(var a=[],r=0;r<e.length;r++){for(var o=0;o<e[r].member.length;o++){var s=[];if(e[r].member[o].sel===!0){for(var u=[],d=0;d<e[r].member[o].tag.length;d++)3!==e[r].member[o].tag[d].tagType&&u.push({tagId:e[r].member[o].tag[d].tagId});s={userId:e[r].member[o].userId,tag:u}}}a.push(s)}if(a.length<1)return l.show("请选择要移出科室黑名单的患者"),!1;for(var r=0;r<a.length;r++)void 0==a[r].userId&&(a.splice(r,1),r--);n.show(),i({method:"PATCH",url:c.getUrl("removeBlackList"),data:{userTag:a}}).success(function(t){if(n.hide(),t.result.success===!0){l.show("移出黑名单成功");for(var r=0;r<e.length;r++)for(var o=0;o<e[r].member.length;o++)for(var s=0;s<a.length;s++)if(e[r].member[o].userId==a[s].userId){e[r].member.splice(o,1),o--;break}for(var i=0;i<e.length;i++)e[i].member.length<1&&(e.splice(i,1),i--);var c={time:0};localStorage.allPatientList=JSON.stringify(c)}})},t.onCancelRemoveClick=function(e){t.isEdit=!1;for(var a=0;a<e.length;a++)for(var r=0;r<e[a].member.length;r++)e[a].member[r].sel===!0&&(e[a].member[r].sel=!1)}}]}}),app.directive("changeInfoController",function(){return{restrict:"AE",templateUrl:"templates/controller/changeInfoController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d){t.phone="",t.identifyCode="",t.password="",t.count=-1,r.debug("changeInfoController"),r.info(t)}]}}),app.directive("chatController",function(){return{restrict:"AE",templateUrl:"templates/controller/chatController.html",replace:!0,scope:{},controller:["$scope","$element","$attrs","$$log","$timeout","$$loading","$$txIM","$$toast","$state","$$title","$$confirm",function(t,e,a,r,o,n,s,l,i,c,u){function d(){s.getHistoryMsgs(function(e){s.markReadLastMsg(localStorage.targetChatId);for(var a,r=e.length-1;r>=0;r--)if(a=s.createMsgEle(e[r],!1)){for(var o=!1,n=0;n<t.msgArray.length;n++)t.msgArray[n].fullTime==a.fullTime&&t.msgArray[n].fromAccount==a.fromAccount&&t.msgArray[n].msg==a.msg&&(o=!0);o||t.msgArray.unshift(a)}for(r=e.length-1;r>=0;r--)if(a=s.createMsgEle(e[r],!1),0!=a&&void 0!=a&&void 0!=a.type){s.saveLastMsg(a),s.setRead(localStorage.targetChatId);break}t.$apply(),t.iscroll.refresh(),t.iscroll.scrollToElement(".msgBlock:last-of-type",0),s.sendIMArray(function(e){for(var a=e.length-1;a>=0;a--){var r=s.createMsgEle(e[a],!1);r&&t.msgArray.push(r)}t.$apply(),t.iscroll.refresh(),t.iscroll.scrollToElement(".msgBlock:last-of-type",0)}),s.saveLastMsg(t.msgArray[t.msgArray.length-1])})}n.show(),t.msg="",t.rows=1,t.msgArray=[],t.updateGroupInfo=function(){localStorage.targetChatId.indexOf("@")>=0&&u.show({title:"修改群组名称",msg:'<input class="h3 border-line border-color-global-base" type="text">',callback:function(){var t=$(".confirm").find("input").val();s.updateGroupInfo(localStorage.targetChatId,t,function(){c.setTitle(t+"("+$(".titleContent").html().split("(")[1])},function(){})},confirmText:"确定",cancelText:"取消"})},t.gotoMsgTag=function(){location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/messageTag"};var g=function(e){r.log("addMsg"),r.debug(e);var a=s.createMsgEle(e,!1);if(!a)return!1;for(var o=0;o<t.msgArray.length;o++)if(t.msgArray[o].fullTime==a.fullTime&&t.msgArray[o].fromAccount==a.fromAccount&&t.msgArray[o].msg==a.msg)return!1;t.msgArray.push(a),t.$apply(),s.saveLastMsg(a),s.markReadLastMsg(localStorage.targetChatId),s.setRead(localStorage.targetChatId),t.iscroll.refresh(),t.iscroll.scrollToElement(".msgBlock:last-of-type",0),localStorage["chatList:"+localStorage.targetChatId]=JSON.stringify(t.msgArray)},p={onMsgNotify:function(t){for(var e=0;e<t.length;e++)t[e].fromAccount!=myChatInfo.id&&t[e].sess._impl.id==localStorage.targetChatId&&g(t[e])}};s.login(p,function(){o(function(){n.hide()},1e3),t.myUserId=myChatInfo.id,t.msgArray=[],s.markReadLastMsg(myChatInfo.id,localStorage.targetChatId),localStorage.targetChatId.indexOf("@")<0?(r.debug("C2C"),r.debug(localStorage.targetChatId),s.getC2CInfo([localStorage.targetChatId],function(t){for(var e=0;e<t.UserProfileItem[0].ProfileItem.length;e++)if("Tag_Profile_IM_Nick"==t.UserProfileItem[0].ProfileItem[e].Tag){c.setTitle(t.UserProfileItem[0].ProfileItem[e].Value);break}}),s.syncC2CMsgs(function(e){for(var a=0;a<e.length;a++)e[a].sess._impl.id==localStorage.targetChatId&&g(e[a]);t.msgArray.length<15&&d(),t.iscroll.refresh(),t.iscroll.scrollToElement(".msgBlock:last-of-type",0)})):d()},function(){}),t.sendMsg=function(){""!==t.msg.trim()&&s.sendTextMsg(t.msg,localStorage.targetChatId,function(e){g(e),t.msg="",t.rows=1,o(function(){t.$apply()})},function(){t.msg="",t.rows=1,o(function(){t.$apply()})})},t.sendEle=function(){localStorage.pushPatient=localStorage.targetChatId,location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/patientPushObj/contentList"},t.showTime=function(e){var a=t.msgArray.indexOf(e);return 0===a||t.msgArray[a].fullTime-t.msgArray[a-1].fullTime>=300},o(function(){t.iscroll=new IScroll(".chatMsg")}),r.debug("chatController"),r.info(t)}]}}),app.directive("chatListController",function(){return{restrict:"AE",templateUrl:"templates/controller/chatListController.html",replace:!0,scope:{},controller:["$scope","$$log","$$txIM","$$toast","$state","$interval",function(t,e,a,r,o,n){t.goChat=function(t){localStorage.targetChatId=t.chatId,imChatType=t.type,location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat"};var s=function(r){var o=a.createMsgEle(r,!0);if(!o)return!1;e.debug("add"),e.info(o);for(var n=0;n<t.chatList.length;n++)if((t.chatList[n].chatId==o.sessId&&o.fullTime>t.chatList[n].lastMsg.fullTime||t.chatList[n].chatId==o.sessId&&void 0==t.chatList[n].lastMsg.fullTime)&&(e.debug("add2"),e.info(o),e.info(t.chatList[n].lastMsg),t.chatList[n].lastMsg=o,t.chatList[n].lastMsgTime=o.fullTime,e.debug("finded"),e.info(o),localStorage.chatList=JSON.stringify(t.chatList),t.$apply()),t.chatList[n].chatId==o.sessId)return localStorage.chatList=JSON.stringify(t.chatList),!1},l={onMsgNotify:function(t){try{for(var a=0;a<t.length;a++)s(t[a])}catch(r){e.debug("page error")}}};t.initList=function(){a.login(l,function(){a.sendIMArray(),a.getAllFriend(function(r){for(var o=!1,n=0;n<r.InfoItem.length;n++){o=!1;for(var l=0;l<t.chatList.length;l++)if(t.chatList[l].chatId==r.InfoItem[n].Info_Account){o=!0;var i=a.loadLastMsg(t.chatList[l].chatId);("empty"==t.chatList[l].lastMsg.type||i.fullTime>t.chatList[l].lastMsg.fullTime)&&(t.chatList[l].lastMsg=i)}o||t.chatList.push({chatId:r.InfoItem[n].Info_Account,name:r.InfoItem[n].SnsProfileItem[0].Value,type:"C2C",lastMsg:a.loadLastMsg(r.InfoItem[n].Info_Account),lastMsgTime:a.loadLastMsg(r.InfoItem[n].Info_Account).fullTime,memberNum:0})}e.debug("C2C list loaded"),e.info(t.chatList),a.syncC2CMsgs(function(t){e.debug("C2C syncC2CMsgs");for(var a=0;a<t.length;a++)s(t[a])}),localStorage.chatList=JSON.stringify(t.chatList),t.$apply()}),a.getAllGroup(function(r){for(var o=!1,n=0;n<r.GroupIdList.length;n++){o=!1;for(var l=0;l<t.chatList.length;l++)if(t.chatList[l].chatId==r.GroupIdList[n].GroupId){o=!0;var i=a.loadLastMsg(t.chatList[l].chatId);("empty"==t.chatList[l].lastMsg.type||i.fullTime>t.chatList[l].lastMsg.fullTime)&&(t.chatList[l].lastMsg=i)}o||t.chatList.push({chatId:r.GroupIdList[n].GroupId,name:r.GroupIdList[n].Name,type:"GROUP",lastMsg:a.loadLastMsg(r.GroupIdList[n].GroupId),lastMsgTime:a.loadLastMsg(r.GroupIdList[n].GroupId).fullTime,memberNum:r.GroupIdList[n].MemberNum}),a.syncGROUPLastMsgs(r.GroupIdList[n].GroupId,function(t){for(var e=0;e<t.length;e++)s(t[e])})}e.debug("GROUP list loaded"),e.info(t.chatList),localStorage.chatList=JSON.stringify(t.chatList),t.$apply()})})},t.chatList=a.loadList(),t.initList(),n(function(){t.initList()},6e4)}]}});var classArr=[],colorName="green",isAddOrder=!0;app.directive("choiceClassController",function(){return{restrict:"AE",templateUrl:"templates/controller/choiceClassController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$location","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u,d,g){if("add"==g.operateType?t.isAdd=!0:t.isAdd=!1,void 0!=t.data.roster&&t.data.roster.length>0)if(classArr.length>0)for(var p=0;p<t.data.roster.length;p++)for(var m=0;m<classArr.length;m++)t.data.roster[p].id==classArr[m].id?t.data.roster[p].sel=!0:t.data.roster[p].sel=t.data.roster[p].sel||!1;else for(var f=0;f<t.data.roster.length;f++)t.data.roster[f].sel=!1;t.chooseOrder=function(t){rosterData=t,o.go("setOrder",{operateType:t.id})},t.confirmRoster=function(){classArr=[];for(var e=0;e<t.data.roster.length;e++)t.data.roster[e].sel===!0&&classArr.push(t.data.roster[e]);history.go(-1)},r.debug("choiceClassController"),r.info(t)}]}}),app.directive("choiceColorController",function(){return{restrict:"AE",templateUrl:"templates/controller/choiceColorController.html",replace:!0,scope:{},controller:["$scope","$element","$attrs","$$log","$$color","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d,g){t.obj=obj,t.selColor=function(t){colorName=t,isAddOrder=!1,history.go(-1)},r.debug("choiceColorController"),r.info(t)}]}});var remindArr=[];app.directive("choiceDayController",function(){return{restrict:"AE",templateUrl:"templates/controller/choiceDayController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d){t.alertClick=function(t){remindArr.length>=1&&(remindArr=[]),remindArr.push(t),history.go(-1)},r.debug("choiceDayController"),r.info(t)}]}});var departmentObj={},aletrNurseInfoOffice={};app.directive("choiceDepartment",function(){return{restrict:"AE",templateUrl:"templates/controller/choiceDepartmentController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$stateParams","$$confirm",function(t,e,a,r,o,n,s,l,i,c,u,d,g){t.dataArr=t.data.organization;for(var p=0;p<t.dataArr.length;p++)t.dataArr[p].organizationId==d.hospitalId&&(t.dataFilter=t.dataArr[p].department);t.newDepartment=function(){g.show({title:"添加科室",msg:'<input class="h3 border-line border-color-global-base padding-left-md" style="width:80%;" type="text">',callback:function(){var e=$(".confirm").find("input").val();return void 0!==t.dataFilter&&0!==t.dataFilter.length||(t.dataFilter=[]),""===e?(i.show("请输入科室名称！"),!1):void s({method:"POST",url:l.getUrl("createDepartment"),data:{organizationId:parseInt(d.hospitalId),departmentName:e}}).success(function(e){return e.result.success===!0?(t.dataFilter.push(e.department),$(".confirm").find("input").val("")):i.show(e.result.displayMsg),e})},confirmText:"确定",cancelText:"取消"})},t.selDepartment=function(t){var e={time:0};void 0==localStorage.allPatientList&&(localStorage.allPatientList=JSON.stringify(e)),void 0==localStorage.nurseList&&(localStorage.nurseList=JSON.stringify(e)),aletrNurseInfoOffice={},departmentObj={},basicInfo.office?departmentObj=t:aletrNurseInfoOffice=t,history.go(-1)}}]}});var hospitalObj={},aletrNurseInfoHospital={};app.directive("choiceHospitalController",function(){return{restrict:"AE",templateUrl:"templates/controller/choiceHospitalController.html",replace:!0,scope:{data:"=data"},controller:["$$confirm","$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope",function(t,e,a,r,o,n,s,l,i,c,u){hospitalObj={},aletrNurseInfoHospital={},e.dataArr=e.data.organization,e.selHospital=function(t){var e={time:0};void 0==localStorage.allPatientList&&(localStorage.allPatientList=JSON.stringify(e)),void 0==localStorage.nurseList&&(localStorage.nurseList=JSON.stringify(e)),o.debug("选中的hospital"),o.debug(t),basicInfo.hospital?(hospitalObj=t,departmentObj={}):(aletrNurseInfoHospital=t,aletrNurseInfoOffice={}),history.go(-1)},e.addHospital=function(){t.show({title:"添加医院",msg:'<input class="h3 border-line border-color-global-base padding-left-md" type="text" style="width:80%;">',callback:function(){var t=$(".confirm").find("input").val();return""===t?(c.show("请输入医院名！"),!1):void l({method:"POST",url:i.getUrl("createHospital"),data:{organizationName:t}}).success(function(t){return t.result.success===!0?(e.dataArr.push(t.organization),$(".confirm").find("input").val("")):c.show(t.result.displayMsg),t})},confirmText:"确定",cancelText:"取消"})}}]}});var templateObj={};app.directive("choiceVisitController",function(){return{restrict:"AE",templateUrl:"templates/controller/choiceVisitController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c){globalTemplateData={},newSelPushTemplate=[],t.followClick=function(t){templateObj=t,history.go(-1)},t.editTemplate=function(){o.go("editVisit",{operateType:"show"})},t.newUser=function(t){o.go("setTemplate",{operateType:"new"})},r.debug("choiceVisitController"),r.info(t)}]}});var rosterData;app.directive("classListController",function(){return{restrict:"AE",templateUrl:"templates/controller/classListController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$location","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u,d,g){t.listClass=function(e){rosterData=t.data.roster[e],o.go("setOrder",{operateType:"orderId"})},r.debug("classListController"),r.info(t)}]}}),app.directive("doVisitController",function(){return{restrict:"AE",templateUrl:"templates/controller/doVisitController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d){t.phone="",t.identifyCode="",t.password="",t.count=-1,r.debug("doVisitController"),r.info(t)}]}});var delCalender=[],admissionTime=null,sortType;app.directive("dutyCalendarController",function(){return{restrict:"AE",templateUrl:"templates/controller/dutyCalendarController.html",replace:!0,scope:{data:"=data",weekOffset:"=weekOffset"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$$loading","$rootScope","$$iconfont","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){function m(e){u.show(),l({method:"GET",url:i.getUrl("changeSchedulePersonStateController",{departmentId:localStorage.globalDepartmentId}),params:{weekOffset:e}}).success(function(e){if(u.hide(),e.result.success===!0){if(t.data=e,void 0!=t.data.scheduleByPerson&&t.data.scheduleByPerson.length>0){t.nums=[],t.dateNum=t.data.scheduleByPerson[0].data,t.nowTime=new Date(t.data.scheduleByPerson[0].data[0].date).format("yyyy年MM月");for(var a=0;a<t.data.scheduleByPerson.length;a++){for(var o=[],n=0;n<t.data.scheduleByPerson[a].data.length;n++)o.push(t.data.scheduleByPerson[a].data[n].rosterIds.length);o.sort(function(t,e){return e-t}),t.nums.push(o[0])}for(var s=0;s<t.data.scheduleByPerson.length;s++)if(t.data.scheduleByPerson[s].personId==localStorage.globalNurseId){var l=t.data.scheduleByPerson[s];t.data.scheduleByPerson.splice(s,1),t.data.scheduleByPerson.unshift(l)}}}else e.result.displayMsg?c.show(e.result.displayMsg):c.show("加载失败");r.debug("dutyCalendarWeekOffsetData"),r.info(e)})}if(t.nums=[],void 0!=t.data.scheduleByPerson&&t.data.scheduleByPerson.length>0){t.dateNum=t.data.scheduleByPerson[0].data;for(var f=0;f<t.data.scheduleByPerson.length;f++){for(var h=[],$=0;$<t.data.scheduleByPerson[f].data.length;$++)h.push(t.data.scheduleByPerson[f].data[$].rosterIds.length);h.sort(function(t,e){return e-t}),t.nums.push(h[0])}}t.nowTimeDay=(new Date).format("yyyy-MM-dd").split("-")[2],t.nowTimeMonth=(new Date).format("yyyy-MM-dd").split("-")[1],admissionTime=null,remindArr=[],t.prevWeek=function(){t.weekOffset=parseInt(t.weekOffset)-1,m(t.weekOffset)},t.nextWeek=function(){t.weekOffset=parseInt(t.weekOffset)+1,m(t.weekOffset)},t.routerToMessageTag=function(){o.go("messageTag")},t.editShedule=function(e,a){sortType="dutyCalendar",admissionTime=e.data[a].date,orderObjArr=[{member:{name:e.name,id:e.personId},delObj:e.data[a].rosterScheduleIds}],classArr=[],delCalender=[];for(var n=0;n<e.data[a].rosterIds.length;n++)for(var s=0;s<t.data.rosters.length;s++)if(t.data.rosters[s].rosterId==e.data[a].rosterIds[n]){delCalender.push({rosterId:e.data[a].rosterIds[n],title:t.data.rosters[s].name});break}for(var l=0;l<e.data[a].rosterIds.length;l++)for(var i=0;i<t.data.rosters.length;i++)if(t.data.rosters[i].rosterId==e.data[a].rosterIds[l]){classArr.push({id:e.data[a].rosterIds[l],title:t.data.rosters[i].name});break}o.go("sort",{operateType:"alert"}),r.debug("dutyCalendarController"),r.info(t)};for(var b=0;b<t.data.scheduleByPerson.length;b++)if(t.data.scheduleByPerson[b].personId==localStorage.globalNurseId){var S=t.data.scheduleByPerson[b];t.data.scheduleByPerson.splice(b,1),t.data.scheduleByPerson.unshift(S),console.log(t.data.scheduleByPerson)}}]}}),app.directive("dutyChangeController",function(){return{restrict:"AE",templateUrl:"templates/controller/dutyChangeController.html",replace:!0,scope:{data:"=data",weekOffset:"=weekOffset"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$$loading","$rootScope","$$iconfont","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u,d,g){function p(e){c.show(),s({method:"GET",url:l.getUrl("changeScheduleClassStateController",{departmentId:localStorage.globalDepartmentId}),params:{weekOffset:e}}).success(function(e){if(c.hide(),e.result.success===!0){if(t.data=e,void 0!=t.data.scheduleByRoster&&t.data.scheduleByRoster.length>0){t.nums=[],t.dateNum=t.data.scheduleByRoster[0].data,t.nowTime=new Date(t.data.scheduleByRoster[0].data[0].date).format("yyyy年MM月");for(var a=0;a<t.data.scheduleByRoster.length;a++){for(var o=[],n=0;n<t.data.scheduleByRoster[a].data.length;n++)o.push(t.data.scheduleByRoster[a].data[n].executors.length);o.sort(function(t,e){return e-t}),t.nums.push(o[0])}}}else e.result.displayMsg?i.show(e.result.displayMsg):i.show("加载失败");r.debug("dutyChangeWeekOffsetData"),r.info(e)})}if(t.nums=[],void 0!=t.data.scheduleByRoster&&t.data.scheduleByRoster.length>0){t.dateNum=t.data.scheduleByRoster[0].data;for(var m=0;m<t.data.scheduleByRoster.length;m++){for(var f=[],h=0;h<t.data.scheduleByRoster[m].data.length;h++)f.push(t.data.scheduleByRoster[m].data[h].executors.length);f.sort(function(t,e){return e-t}),t.nums.push(f[0])}}t.nowTimeDay=(new Date).format("yyyy-MM-dd").split("-")[2],t.nowTimeMonth=(new Date).format("yyyy-MM-dd").split("-")[1],admissionTime=null,t.prevWeek=function(){t.weekOffset=parseInt(t.weekOffset)-1,p(t.weekOffset)},t.nextWeek=function(){t.weekOffset=parseInt(t.weekOffset)+1,p(t.weekOffset)},t.routerToMessageTag=function(){o.go("messageTag")},t.setShedules=function(t,e){return!1},r.debug("dutyChangeController"),r.info(t)}]}}),app.directive("dutyListController",function(){return{restrict:"AE",templateUrl:"templates/controller/dutyListController.html",replace:!0,scope:{data:"=data",showDetail:"=showDetail",patientTag:"=patientTag",patientId:"=patientId",weekOffset:"=weekOffset"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$$loading","$$title","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){function m(e){u.show(),l({method:"GET",url:i.getUrl("batchSchedulesStateController",{departmentId:localStorage.globalDepartmentId}),params:{weekOffset:parseInt(e)}}).success(function(e){if(u.hide(),e.result.success===!0){t.data=e,t.dateNum=t.data.scheduleByPerson[0].data,d.setTitle("批量排班（"+new Date(t.data.scheduleByPerson[0].data[0].date).format("MM")+"月）");for(var a=0;a<t.data.scheduleByPerson.length;a++)if(t.data.scheduleByPerson[a].personId==localStorage.globalNurseId){var o=t.data.scheduleByPerson[a];t.data.scheduleByPerson.splice(a,1),t.data.scheduleByPerson.unshift(o),console.log(t.data.scheduleByPerson)}}else e.result.displayMsg?c.show(e.result.displayMsg):c.show("加载失败");r.debug("dutyListWeekOffsetData"),r.info(e)})}if(console.log(t.data),void 0!=t.data.scheduleByPerson&&t.data.scheduleByPerson.length>0&&(t.dateNum=t.data.scheduleByPerson[0].data),t.selRoster=void 0!=t.data.rosters&&t.data.rosters.length>0?t.data.rosters[0].rosterId:-1,t.nowTimeDay=(new Date).format("yyyy-MM-dd").split("-")[2],t.nowTimeMonth=(new Date).format("yyyy-MM-dd").split("-")[1],admissionTime=null,t.changeSelRoster=function(e){t.selRoster=e},d.setTitle("批量排班（"+new Date(t.data.scheduleByPerson[0].data[0].date).format("MM")+"月）"),t.prevWeek=function(){t.weekOffset=parseInt(t.weekOffset)-1,m(t.weekOffset)},t.nextWeek=function(){t.weekOffset=parseInt(t.weekOffset)+1,m(t.weekOffset)},t.dutyList=function(){o.go("dutyCalendar")},t.routerToMessageTag=function(){history.go(-1)},t.changeShedule=function(e,a,o){return t.selRoster<0?(c.show("请新建班次"),!1):void(e.data[o].rosterIds.indexOf(t.selRoster)>-1?(u.show(),l({method:"DELETE",url:i.getUrl("dropSchedule",{rosterScheduleIds:e.data[o].rosterScheduleIds[e.data[o].rosterIds.indexOf(t.selRoster)]})}).success(function(a){u.hide(),a.result.success===!0?(e.data[o].rosterScheduleIds.remove(e.data[o].rosterIds.indexOf(t.selRoster)),e.data[o].rosterIds.remove(e.data[o].rosterIds.indexOf(t.selRoster))):c.show(a.result.displayMsg);var n={time:0};localStorage.changeScheduleClassStateController=JSON.stringify(n),localStorage.batchSchedulesStateController=JSON.stringify(n),localStorage.changeSchedulePersonStateController=JSON.stringify(n),r.debug("deleteClass"),r.info(a)})):(u.show(),l({method:"POST",url:i.getUrl("createSchedule",{rosterScheduleId:e.data[o].rosterScheduleIds[e.data[o].rosterIds.indexOf(t.selRoster)]}),data:{rosterId:t.selRoster,executorId:e.personId,date:e.data[o].date}}).success(function(a){u.hide(),a.result.success===!0?(e.data[o].rosterScheduleIds.push(a.id),e.data[o].rosterIds.indexOf(t.selRoster)==-1&&e.data[o].rosterIds.push(t.selRoster)):c.show(a.result.displayMsg);var n={time:0};localStorage.changeScheduleClassStateController=JSON.stringify(n),localStorage.batchSchedulesStateController=JSON.stringify(n),localStorage.changeSchedulePersonStateController=JSON.stringify(n),r.debug("createSchedule"),r.info(a)})))},void 0!=t.data.rosters&&t.data.rosters.length>0){var f,h=t.data.rosters.length;f=h%5===0?h/5:parseInt(h/5+1),$("table").css("margin-top",1.6*f+3+"rem")}for(var b=0;b<t.data.scheduleByPerson.length;b++)if(t.data.scheduleByPerson[b].personId==localStorage.globalNurseId){var S=t.data.scheduleByPerson[b];t.data.scheduleByPerson.splice(b,1),t.data.scheduleByPerson.unshift(S),console.log(t.data.scheduleByPerson)}}]}}),app.directive("editVisitController",function(){return{restrict:"AE",templateUrl:"templates/controller/editVisitController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u){"add"==u.operateType?t.isAdd=!0:t.isAdd=!1,t.goSetTemplate=function(t){globalTemplateData=t,o.go("setTemplate",{operateType:t.templateId})},t.newTemplate=function(){globalTemplateData={},o.go("setTemplate",{operateType:"new"})},r.debug("editVisitControl$$$ler"),r.info(t)}]}}),app.directive("guidePageController",function(){return{restrict:"AE",templateUrl:"templates/controller/guidePageController.html",replace:!0,scope:{},controller:["$timeout","$scope",function(t,e){var a;e.selIndex=0,localStorage.guided="true",t(function(){a=new Swiper(".swiper-container",{pagination:".swiper-pagination",onSlideNextStart:function(){e.selIndex++,t(function(){e.$apply()})},onSlidePrevStart:function(){e.selIndex--,t(function(){e.$apply()})}})}),e.next=function(){a.slideNext()}}]}});var globalNursePhone="";app.directive("loginController",function(){return{restrict:"AE",templateUrl:"templates/controller/loginController.html",replace:!0,controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$getClientInfo","$$toast","$rootScope","$$iconfont","$$loading","$$shence",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){t.phone="",t.identifyCode="",t.password="",t.count=0,t.checkPhone=function(){0==t.phone.toString().length?u.show("输入的电话号码不能为空"):t.phone.toString().length<11?u.show("输入的电话号码不正确"):(p.show(),l({method:"POST",url:i.getUrl("getLoginPhoneCaptcha"),data:{phone:t.phone.toString()}}).success(function(e){"undefined"!=typeof e.result.success&&p.hide(),r.info(e),1==e.result.success?(t.count=60,t.count>0&&(t.countDown=n(function(){t.count--,r.debug(t.count)},1e3,60))):u.show(e.result.displayMsg)}))},t.nextUser=function(){if(t.phone.toString().length<=0||t.identifyCode.toString().length<=0)return u.show("请检查再提交"),!1;p.show();var e=t.phone,a=t.identifyCode;localStorage.phone=e.toString(),l({method:"post",url:i.getUrl("signIn"),data:{phone:e.toString(),captcha:a.toString()}}).success(function(a){return"undefined"!=typeof a.result.success&&p.hide(),0==a.result.success?(u.show("验证码错误"),!1):(n.cancel(t.countDown),r.info(a),localStorage.token=a.token,localStorage.globalNurseId=a.nurse.id,localStorage.authorizedStatus=a.nurse.authorizedStatus,r.debug("response.nurse.phone"+a.nurse.phone),r.debug(" phone.toString()"+e.toString()),globalNursePhone=a.nurse.phone?a.nurse.phone:e.toString(),r.debug("localStorage.token:"+localStorage.token),r.debug("LocalStorage.globalNurseId:"+localStorage.globalNurseId),r.debug("globalNursePhone:"+globalNursePhone),a.newly===!0?o.go("basicInfo"):("undefined"!=typeof a.nurse.departmentId&&""!=a.nurse.departmentId?localStorage.globalDepartmentId=a.nurse.departmentId:r.debug("localStorage.globalDepartmentId is null"),"undefined"!=typeof a.nurse.departmentName&&""!=a.nurse.departmentName?localStorage.department=a.nurse.departmentName:r.debug("localStorage.department is null"),"undefined"!=typeof a.nurse.organizationName&&""!=a.nurse.organizationName?localStorage.hospital=a.nurse.organizationName:r.debug("localStorage.hospital is null"),"undefined"!=typeof a.nurse.organizationId&&""!=a.nurse.organizationId?localStorage.hospitalId=a.nurse.organizationId:r.debug("localStorage.hospitalId is null"),l({method:"POST",url:i.getUrl("createDeviceClient"),data:{personId:localStorage.globalNurseId,cid:c.clientid}}).success(function(t){
function e(t){location.href=t}0==t.result.success?localStorage.gloalIsGetDeviceID=!1:localStorage.gloalIsGetDeviceID=!0;var a=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/messageTag";e(a)})),void 0)})}}]}}),app.directive("nurseTagManageController",function(){return{restrict:"AE",templateUrl:"templates/controller/nurseTagManageController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope","$$loading","$$confirm",function(t,e,a,r,o,n,s,l,i,c,u,d){if(t.searchKey="",t.isSearch=!1,"undefined"!=typeof t.data.tag)for(var g=0;g<t.data.tag.length;g++)t.data.tag[g].isShow=!0;t.onAddTag=function(){d.show({title:"添加护士标签",msg:'<input class="h3 border-line border-color-global-base padding-left-md"  style="width:80%;" type="text">',callback:function(){var e=[],a=$(".confirm").find("input").val();return""==a?(i.show("标签名不能为空！"),!1):(e.push({tagName:a}),void s({method:"POST",url:l.getUrl("createNurseTagInManage"),data:{tag:e}}).success(function(e){if(1==e.result.success){if(void 0==t.data.tag)for(var a=0;a<e.tag.length;a++)t.data.tag=[{tagId:e.tag[a].tagId,tagName:e.tag[a].tagName,tagType:e.tag[a].tagType,isShow:!0}];else for(var a=0;a<e.tag.length;a++)t.data.tag.push({tagId:e.tag[a].tagId,tagName:e.tag[a].tagName,tagType:e.tag[a].tagType,isShow:!0});$(".confirm").find("input").val(""),r.debug("111111"),r.debug(t.data.tag)}else i.show(e.result.displayMsg)}))},confirmText:"添加",cancelText:"取消"})},t.onDelTag=function(t){r.debug("tagId"+t.tagId),d.show({title:"删除提示",msg:"确认删除该护士标签吗",callback:function(){u.show();var e=[{tagId:t.tagId}];s({method:"POST",url:l.getUrl("deleteNurseTag"),data:{tag:e}}).success(function(e){if("undefined"!=typeof e.result.success&&u.hide(),1==e.result.success){t.isShow=!1,$(".confirm").find("input").val("");var a={time:0};localStorage.nurseList=JSON.stringify(a)}else i.show(e.result.displayMsg)})},confirmText:"确定",cancelText:"取消"})},t.onAlterTag=function(e){r.debug("tagId"+e.tagId),r.debug("tagId"+e.tagName),d.show({title:"修改护士标签",msg:'<input id="alertTag" class="h3 border-line border-color-global-base padding-left-md" value="'+e.tagName+'" style="width:80%;" type="text">',callback:function(){var a=[],r=$("#alertTag").val();return""==r?(i.show("标签名不能为空！"),!1):(a.push({tagId:e.tagId,tagName:r}),void s({method:"PATCH",url:l.getUrl("updateNurseTag"),data:{tag:a}}).success(function(e){if(1==e.result.success){for(var a=0;a<e.tag.length;a++)for(var r=0;r<t.data.tag.length;r++)e.tag[a].tagId==t.data.tag[r].tagId&&(t.data.tag[r]={isShow:!0,tagCategoryId:e.tag[a].tagCategoryId,tagCategoryName:e.tag[a].tagCategoryName,tagId:e.tag[a].tagId,tagName:e.tag[a].tagName,tagType:e.tag[a].tagType});$(".confirm").find("input").val("");var o={time:0};localStorage.nurseList=JSON.stringify(o)}else i.show(e.result.displayMsg)}))},confirmText:"确认",cancelText:"取消"})},t.onClearInput=function(){t.searchKey=""},t.onIsSearchStatus=function(e){t.isSearch=e,0==t.isSearch?t.searchKey="":$(".searchInput").focus()}}]}});var followPatientObj={};app.directive("patientListController",function(){return{restrict:"AE",templateUrl:"templates/controller/patientListController.html",replace:!0,scope:{data:"=data"},controller:["$$patientFilter","$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){if(e.searchKey=null,e.isSearch=!1,e.isManage=localStorage.getItem("authorizedStatus")>3,e.nurseType=localStorage.globalNurseId,0==e.data.result.success)return e.service=!1,u.show(e.data.result.displayMsg),!1;switch(e.service=!0,p.operateType){case"show":if(e.isSelect=!1,e.inNum=0,e.allNum=0,"undefined"!=typeof e.data.user)for(var m=0;m<e.data.user.length;m++)if(void 0!==e.data.user[m].member){e.allNum+=e.data.user[m].member.length;for(var f=0;f<e.data.user[m].member.length;f++)0!==e.data.user[m].member[f].status&&e.inNum++}e.outNum=e.allNum-e.inNum;break;case"selectFollowObj":e.isSelect=!0}if(e.operateType=p.operateType,"undefined"!=typeof e.data.user&&1!=e.isManage){for(var m=0;m<e.data.user.length;m++)for(var f=0;f<e.data.user[m].member.length;f++)if("undefined"!=typeof e.data.user[m].member[f].tag){o.debug("typeof $scope.data.user[i].member[j].tag "),o.debug("undefined"!=typeof e.data.user[m].member[f].tag);for(var h=0;h<e.data.user[m].member[f].tag.length;h++){if(3==e.data.user[m].member[f].tag[h].tagType){e.data.user[m].member[f].isBlack=!0,o.debug("$scope.data.user[i].member[j].isBlack"),o.debug(e.data.user[m].member[f].isBlack);break}e.data.user[m].member[f].isBlack=!1}}else e.data.user[m].member[f].isBlack=!1;for(var m=0;m<e.data.user.length;m++)e.data.user[m].isNull=!1;for(var m=0;m<e.data.user.length;m++)for(var f=0;f<e.data.user[m].member.length;f++){var b=0;1==e.data.user[m].member[f].isBlack&&(b+=1,o.debug("flag"+b),o.debug("$scope.data.user[i].member.length"+e.data.user[m].member.length),b==e.data.user[m].member.length&&(e.data.user[m].isNull=!0))}o.debug("$scope.data.user"),o.debug(e.data.user)}e.patientData=e.data.user,e.patientAllCheck=function(t){t.sel=2==t.sel?0:2;for(var e=0;e<t.length;e++)for(var a=0;a<t[e].member.length;a++)t[e].member[a].sel=2==t.sel},e.checkPatientSelf=function(t,e){e.sel=!e.sel,followPatientObj=e,history.go(-1)},e.patientObj=function(){followPatientObj.length>=1&&(followPatientObj=[]);for(var t=0;t<e.patientData.length;t++)for(var a=0;a<e.patientData[t].member.length;a++)e.patientData[t].member[a].sel===!0&&followPatientObj.push(e.patientData[t].member[a]);0===followPatientObj.length?u.show("请选择随访对象"):history.go(-1)},e.onClearInput=function(){e.searchKey=""},e.onIsSearchStatus=function(t){e.isSearch=t,0==e.isSearch?e.searchKey="":$(".searchInput").focus()}}]}}),app.directive("patientRelationController",function(){return{restrict:"AE",templateUrl:"templates/controller/patientRelationController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$$confirm","$$toast","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$loading","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){if(t.attentionIds=[],void 0!==patientInfo.tag)for(var m=0;m<patientInfo.tag.length;m++)2==patientInfo.tag[m].tagType&&localStorage.globalNurseId==patientInfo.tag[m].tagName&&(t.isAttention=!0),3==patientInfo.tag[m].tagType&&(t.isBlackList=!0);else t.isAttention=!1,t.isBlackList=!1;if(void 0!==patientInfo.departmentTag&&void 0!==patientInfo.departmentTag.tag)for(var f=0;f<patientInfo.departmentTag.tag.length;f++)for(var m=0;m<patientInfo.departmentTag.tag[f].tag.length;m++)3==patientInfo.departmentTag.tag[f].tag[m].tagType&&(t.blackListTagId={tagId:patientInfo.departmentTag.tag[f].tag[m].tagId}),2==patientInfo.departmentTag.tag[f].tag[m].tagType&&t.attentionIds.push(patientInfo.departmentTag.tag[f].tag[m]);t.onChangeAttentionClick=function(){var e=[];if(1==t.isBlackList)return a.show("请先将该患者移出科室黑名单，然后添加关注"),!1;if(d.show(),void 0!==patientInfo.tag)for(var r=0;r<patientInfo.tag.length;r++)patientInfo.tag[r].tagName!=localStorage.globalNurseId&&3!=patientInfo.tag[r].tagType&&e.push({tagId:patientInfo.tag[r].tagId});1!=t.isAttention&&e.push({tagId:-1}),c({method:"PATCH",url:u.getUrl("attentionTagStateController",{nurseId:patientInfo.userId}),data:{tag:e}}).success(function(e){if(d.hide(),e.result.success===!0){var r=1!=t.isAttention?"添加关注成功":"取消关注成功";t.isAttention=1!=t.isAttention,a.show(r);var o={time:0};localStorage.allPatientList=JSON.stringify(o)}})},t.onChangeStatusClick=function(){if("4"!==localStorage.authorizedStatus&&"5"!==localStorage.authorizedStatus)return a.show("您没有权限进行此操作"),!1;if(t.isBlackList!==!0){var r;r=t.attentionIds.length>0?"该患者已经被"+t.attentionIds.length+"位护士关注，加入科室黑名单将取消所有关注，确定加入科室黑名单吗？":"加入科室黑名单将取消所有关注，确定加入科室黑名单吗吗？",e.show({title:"重要提示",msg:r,callback:function(){h()},confirmText:"确定",cancelText:"取消"})}else h()};var h=function(){var e=[];if(void 0!==patientInfo.tag)for(var r=0;r<patientInfo.tag.length;r++)2!=patientInfo.tag[r].tagType&&3!=patientInfo.tag[r].tagType&&e.push({tagId:patientInfo.tag[r].tagId});1!=t.isBlackList&&e.push(t.blackListTagId),d.show(),c({method:"PATCH",url:u.getUrl("blackListTagStateController",{nurseId:patientInfo.userId}),data:{tag:e}}).success(function(e){if(d.hide(),e.result.success===!0){var r=1!=t.isBlackList?"加入科室黑名单成功":"移出科室黑名单成功";t.isBlackList=1!=t.isBlackList,t.isAttention=1!=t.isBlackList&&t.isBlackList,a.show(r);var o={time:0};localStorage.allPatientList=JSON.stringify(o)}})}}]}}),app.directive("patientTagManageController",function(){return{restrict:"AE",templateUrl:"templates/controller/patientTagManageController.html",replace:!0,scope:{data:"=data"},controller:["$$confirm","$scope","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$$loading",function(t,e,a,r,o,n,s,l,i,c,u){if(o.debug("data"),o.debug(e.data),e.isDelState=!1,e.isSearch=!1,e.searchKey="",e.searchTag=null,e.searchJuge=null,void 0!=e.data.tag)for(var d=0;d<e.data.tag.length;d++){for(var g=0;g<e.data.tag[d].tag.length;g++){e.data.tag[d].tag[g].isShow=!0;var p=0;e.data.tag[d].tag[g].tagType<2&&p++,o.debug("flag"+p),o.debug("$scope.data.tag[j].tag[k].length"+e.data.tag[d].tag.length),p>0?e.data.tag[d].isShow=!0:e.data.tag[d].isShow=!1}var m=0;0==e.data.tag[d].isShow&&m++,m==e.data.tag.length&&(e.data.tag.length=0)}e.onClearInput=function(){e.searchKey=""},e.onIsSearchStatus=function(t){e.isSearch=t,0==e.isSearch?e.searchKey="":$(".searchInput").focus()},e.onAlertTag=function(a,r){o.debug("tag.tagId"+a.tagId),e.isDelState?t.show({title:"删除提示",msg:"确认删除该标签吗？",callback:function(){l({method:"POST",url:i.getUrl("deletePatientTag"),data:{tag:{tagId:a.tagId}}}).success(function(t){if(1==t.result.success){$(".confirm").find("input").val(""),a.isShow=!1;for(var e=0,o=0;o<r.tag.length;o++)1==r.tag[o].isShow&&e++,e>0?r.isShow=!0:r.isShow=!1;var n={time:0};localStorage.allPatientList=JSON.stringify(n)}else c.show(t.result.displayMsg)})},confirmText:"确认",cancelText:"取消"}):(o.debug("tag.tagName"+a.tagName),o.debug("tag.tagId"+a.tagId),t.show({title:"修改患者标签",msg:'<input class="h3 border-line border-color-global-base padding-left-md" value="'+a.tagName+'" style="width:80%;" type="text">',callback:function(){var t=[],r=$(".confirm").find("input").val();return o.debug("tagName"+r),""==r?(c.show("标签名不能为空！"),!1):(t.push({tagId:a.tagId,tagName:r}),void l({method:"PATCH",url:i.getUrl("updateDepartmentPatientTag"),data:{tag:t}}).success(function(t){if(1==t.result.success){for(var a=0;a<t.tag.length;a++)for(var n=0;n<e.data.tag.length;n++)for(var s=0;s<e.data.tag[n].tag.length;s++)o.debug("$scope.data.tag[j].tag[k].tagId"+e.data.tag[n].tag[s].tagId),o.debug("response.tag[i].tagId"+t.tag[a].tagId),o.debug(e.data.tag[n].tag[s].tagId==t.tag[a].tagId),e.data.tag[n].tag[s].tagId==t.tag[a].tagId&&(e.data.tag[n].tag[s].tagName=t.tag[a].tagName||r,o.debug("$scope.data.tag[j].tag[k].tagName "+e.data.tag[n].tag[s].tagName));var l={time:0};localStorage.allPatientList=JSON.stringify(l)}else c.show(t.result.displayMsg);$(".confirm").find("input").val("")}))},confirmText:"确认",cancelText:"取消"}))},e.onAddTag=function(a){t.show({title:"添加标签",msg:'<input class="h3 border-line border-color-global-base padding-left-md" style="width:80%;" type="text">',callback:function(){o.debug(a);var t=a.tagCategoryId,r=$(".confirm").find("input").val(),n=[{tagName:r,tagCategoryId:t}];o.debug("tagsObj"),o.debug(n),""!=r?(u.show(),l({method:"POST",url:i.getUrl("createPatientCategoryTag"),data:{tag:n}}).success(function(t){if("undefined"!=t.result.success&&u.hide(),t.result.success===!0){for(var a=0;a<t.tag.length;a++)for(var r=0;r<e.data.tag.length;r++)e.data.tag[r].tagCategoryId==t.tag[a].tagCategoryId&&(e.data.tag[r].isShow=!0,e.data.tag[r].tag.push({tagId:t.tag[a].tagId,tagName:t.tag[a].tagName,tagCategoryId:t.tag[a].tagCategoryId,tagCategoryName:t.tag[a].tagCategoryName,tagType:t.tag[a].tagType,isShow:!0}));o.debug("$scope.dataArr.departmentTag"),o.debug(e.data.tag),$(".confirm").find("input").val("")}else{var n=t.result.displayMsg;c.show(n.toString())}return o.debug("createPatientCategoryTag"),o.info(t),t})):c.show("数据项不能为空")},confirmText:"确定",cancelText:"取消"})},e.onAddCategory=function(){t.show({title:"添加分类",msg:'<label for="tagCategoryName">分类：</label><input style="margin-bottom:0.64rem;" id="tagCategoryName" class="h3 border-line border-color-global-base padding-left-md" type="text"><br/><label for="tagCategoryName">标签：</label><input id="tagName" class="h3 border-line border-color-global-base padding-left-md" type="text">',callback:function(){var t=$(".confirm").find("#tagCategoryName").val(),a=$(".confirm").find("#tagName").val();o.debug(t),o.debug(a);var r=[{tagId:null,tagName:a,tagCategoryId:null,tagCategoryName:t}];o.debug("categoriesArr"),o.debug(r),""!=t&&""!=a?(u.show(),l({method:"POST",url:i.getUrl("createPatientTagCategory"),data:{tag:r}}).success(function(t){if(1==t.result.success){if(u.hide(),o.debug(t.tag+"response.tag"),t.tag.length>0)for(var a=0;a<t.tag.length;a++)if("undefined"==typeof e.data.tag)e.data.tag=[{tag:[{tagId:t.tag[a].tagId,tagName:t.tag[a].tagName,tagCategoryId:t.tag[a].tagCategoryId,tagCategoryName:t.tag[a].tagCategoryName,tagType:t.tag[a].tagType,isShow:!0}],tagCategoryId:t.tag[a].tagCategoryId,tagCategoryName:t.tag[a].tagCategoryName,isShow:!0}],o.debug("当前用户的$scope.dataArr.departmentTags为空，添加后的$scope.dataArr.departmentTags："),o.debug(e.data.tag);else for(var r=0;r<t.tag.length;r++)e.data.tag.push({tag:[{tagId:t.tag[a].tagId,tagName:t.tag[a].tagName,tagCategoryId:t.tag[a].tagCategoryId,tagCategoryName:t.tag[a].tagCategoryName,tagType:t.tag[a].tagType,isShow:!0}],tagCategoryId:t.tag[r].tagCategoryId,tagCategoryName:t.tag[r].tagCategoryName,isShow:!0})}else{var n=t.result.displayMsg;c.show(n.toString())}$(".confirm").find("#tagCategoryName").val(""),$(".confirm").find("#tagName").val(""),o.debug("createPatientTagCategory.response"),o.info(t)})):c.show("数据项不能为空")},confirmText:"确定",cancelText:"取消"})},e.onShowDelStatus=function(){e.isDelState=!0},e.onHideDelStatus=function(){e.isDelState=!1},e.isTag=function(t){return t.tagCategoryName.indexOf(e.searchKey)>=-1}}]}}),app.directive("professionInfoController",function(){return{restrict:"AE",templateUrl:"templates/controller/professionInfoController.html",replace:!0,scope:{data:"=data"},controller:["$$env","$$loading","$scope","$element","$attrs","$$log","$state","$http","$$requestUrl","$$toast",function(t,e,a,r,o,n,s,l,i,c){function u(t){$(""+t+"-file").trigger("click"),$(""+t+"-img").bind("click",function(){$(""+t+"-file").trigger("click")})}a.IDNumber="",a.practiceNum="",a.technologyNum="",a.otherName="",a.otherNum="",a.numAllrr=[2],a.numArrLength=1,a.photocopyArr=[],a.imgArray=[],$("#id-1").on("click",function(){var t=$(this).attr("id");u("#"+t)}),a.delImg=function(t){t.isShow=!t.isShow},a.changeUserHead=function(r){function o(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function s(t){var e=t.lastIndexOf(".");return t.substring(e+1)}var l=document.getElementById("id-1-file").files[0],i=document.getElementById("id-1-file").files[0].name,u=s(i),d="avatar/"+o()+"."+u,g="",p="";1==t.getEnvirement()?(n.debug("dev 1"),g="yhjstatic-dev",p="http://yhjstatic-dev.oss-cn-shanghai.aliyuncs.com/"):2==t.getEnvirement()&&(n.debug("pro 2"),g="yhjstatic",p="http://yhjstatic.oss-cn-shanghai.aliyuncs.com/");var m=new OSS.Wrapper({region:"oss-cn-shanghai",accessKeyId:"LTAICadISGBAyskk",accessKeySecret:"TSnzCdIizqqW1QdW7VxbBJYStaMeZj",bucket:g});e.show(),m.multipartUpload(d,l).then(function(t){var r=p+t.name+"?x-oss-process=image/resize,h_500";n.debug("返回的图片路径为："+r),a.imgArray.push({url:r,isShow:!0}),a.$apply(),e.hide(),$("#id-1-text").hide(),$("#id-2-text").show()})["catch"](function(t){e.hide(),c.show("上传失败！请重新上传"),n.debug(t)})},a.register=function(){function t(t){location.href=t}for(var e=0;e<a.imgArray.length;e++)1==a.imgArray[e].isShow&&a.photocopyArr.push(a.imgArray[e].url);if(a.occupation={IDNumber:a.IDNumber.toString(),certs:JSON.stringify([{certNo:a.practiceNum,certName:"护士执业证书管理号"},{certNo:a.technologyNum,certName:"护士专业技术资格证书管理号"},{certNo:a.otherNum,certName:a.otherName}]),photocopy:JSON.stringify(a.photocopyArr)},a.photocopyArr.length<0||""==a.IDNumber||""==a.practiceNum||""==a.technologyNum||a.photocopyArr.length<0)return c.show("请检查信息再提交"),!1;var r={occupation:a.occupation};n.info(r),l({method:"PATCH",url:i.getUrl("createProfessionInfo",{nurseId:localStorage.globalNurseId}),data:{occupation:a.occupation}}).success(function(e){if(n.debug("createRegisterInfoStateController"),n.info(e),1==e.result.success){var a=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/messageTag";t(a)}else c.show(e.result.display)})}}]}}),app.directive("scheduleController",function(){return{restrict:"AE",templateUrl:"templates/controller/scheduleController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont",function(t,e,a,r,o,n,s,l,i,c,u,d){r.debug("scheduleController"),r.info(t)}]}});var obj={colorId:[1,2,3,4,5,6],ColorName:["#32c86e","#fd8a58","#f25d5d","#fec24b","#529eff","#ff8080","#8a8ae7"],name:"",description:"",from:"",to:""};app.directive("setOrderController",function(){return{restrict:"AE",templateUrl:"templates/controller/setOrderController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$stateParams","$element","$attrs","$$log","$state","$interval","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$timeout","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){t.getDTime=function(t){return new Date(t).format("hh:mm")},t.setStartTime=function(){try{var e=new Date;e.setHours(t.from.format("hh"),t.from.format("mm")),plus.nativeUI.pickTime(function(e){t.from=e.date,g(function(){t.$apply()},500)},function(t){},{title:"请选择开始时间",is24Hour:!0,time:e})}catch(a){}},t.setEndTime=function(){try{var e=new Date;e.setHours(t.to.format("hh"),t.to.format("mm")),plus.nativeUI.pickTime(function(e){t.to=e.date,g(function(){t.$apply()},500)},function(t){},{title:"请选择结束时间",is24Hour:!0,time:e})}catch(a){}},$(".triggerInputWarp").on("click",".triggerInput",function(){$(this).find("input").focus()});var m=(new Date).format("yyyy/MM/dd");"new"==e.operateType?isAddOrder===!1?(t.title=obj.name,t.describe=obj.description,t.from=obj.from,t.to=obj.to,t.colorClass=colorName,isAddOrder=!0):(t.title="",t.describe="",t.from=new Date(m+" 08:00"),t.to=new Date(m+" 18:00"),t.colorClass="green"):(t.title=rosterData.title,t.describe=rosterData.description,"string"==typeof rosterData.startTime?t.from=new Date(m+" "+rosterData.startTime):t.from=rosterData.startTime,"string"==typeof rosterData.startTime?t.to=new Date(m+" "+rosterData.endTime):t.to=rosterData.endTime,isAddOrder===!1?(t.colorClass=colorName,isAddOrder=!0):t.colorClass=rosterData.colorClass),t.getColor=function(){"new"==e.operateType?(obj.name=t.title,obj.description=t.describe,obj.from=t.from,obj.to=t.to):(rosterData.title=t.title,rosterData.description=t.describe,rosterData.startTime=t.from,rosterData.endTime=t.to),n.go("choiceColor")},t.setOrder=function(){return t.title.length>3?(c.show("班次最多可输入3个字"),!1):""==t.title||""==t.describe||""==t.from||""==t.to||""==t.colorClass?(c.show("请检查信息后提交"),!1):void("new"==e.operateType?(p.show(),l({method:"POST",url:i.getUrl("createNurseScheduleStateController"),data:{title:t.title,description:t.describe,startTime:new Date(t.from).format("hh:mm"),endTime:new Date(t.to).format("hh:mm"),colorClass:t.colorClass,gaps:0}}).success(function(t){if(p.hide(),1==t.result.success){var e={time:0};localStorage.changeScheduleClassStateController=JSON.stringify(e),localStorage.batchSchedulesStateController=JSON.stringify(e),localStorage.changeSchedulePersonStateController=JSON.stringify(e),colorName="",rosterData="",c.show("创建成功"),history.go(-1)}else c.show(t.result.msg)})):(p.show(),l({method:"POST",url:i.getUrl("updateNurseSchedule",{rosterId:rosterData.id}),data:{title:t.title,description:t.describe,startTime:new Date(t.from).format("hh:mm"),endTime:new Date(t.to).format("hh:mm"),colorClass:t.colorClass,gaps:0}}).success(function(t){if(p.hide(),1==t.result.success){var e={time:0};localStorage.changeScheduleClassStateController=JSON.stringify(e),localStorage.batchSchedulesStateController=JSON.stringify(e),localStorage.changeSchedulePersonStateController=JSON.stringify(e),colorName="",rosterData="",c.show("修改成功"),history.go(-1)}else c.show(t.result.msg)})))},o.debug("setOrderController"),o.info(t)}]}});var oldSelPushTemplate;app.directive("setTemplateController",function(){return{restrict:"AE",templateUrl:"templates/controller/setTemplateController.html",replace:!0,scope:{data:"=data"},controller:["$$toast","$stateParams","$scope","$attrs","$$log","$element","$state","$interval","$http","$$requestUrl","$rootScope","$$iconfont","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g){function p(t){for(var e in t)return!1;return!0}if(a.dataArrFilter=[],"new"==e.operateType){var m=[{title:"",event:[{days:"",purpose:"",article:[],tool:[],eventMark:0}]}];a.dataArrFilter=p(globalTemplateData)?m:[globalTemplateData]}else{if(1==p(globalTemplateData))for(var f=a.data,h=0;h<f.followUp.length;h++)f.followUp[h].templateId==e.operateType&&(a.dataArrFilter.push(f.followUp[h]),globalTemplateData=f.followUp[h]);else a.dataArrFilter.push(globalTemplateData);for(var $=0;$<a.dataArrFilter.length;$++)for(var b=0;b<a.dataArrFilter[$].event.length;b++)a.dataArrFilter[$].event[b].eventMark=b}a.addFollowUpRecord=function(){a.arr={days:"",purpose:"",article:[],tool:[],eventMark:a.dataArrFilter[0].event.length},a.dataArrFilter[0].event.push(a.arr),globalTemplateData=a.dataArrFilter[0]},a.selPush=function(t){"new"==e.operateType&&1==p(globalTemplateData)&&(globalTemplateData=a.dataArrFilter[0]),void 0==t.tool&&(t.tool=[]),void 0==t.article&&(t.article=[]),oldSelPushTemplate={eventMark:t.eventMark,article:t.article,tool:t.tool},s.go("contentList",{operateType:"pushTemplate"})};for(var S in newSelPushTemplate)void 0==newSelPushTemplate[S].article&&(newSelPushTemplate[S].article=[]),void 0==newSelPushTemplate[S].tool&&(newSelPushTemplate[S].tool=[]);if(newSelPushTemplate.length>0)for(var I=0;I<a.dataArrFilter.length;I++)for(var v=0;v<a.dataArrFilter[I].event.length;v++)for(var y=0;y<newSelPushTemplate.length;y++)a.dataArrFilter[I].event[v].eventMark==newSelPushTemplate[y].eventMark&&(a.dataArrFilter[I].event[v].article=newSelPushTemplate[y].article,a.dataArrFilter[I].event[v].tool=newSelPushTemplate[y].tool);a.saveFollowUpRecord=function(){if(""==a.dataArrFilter[0].title)return t.show("请检查信息后提交"),!1;for(var r=[],n=a.dataArrFilter[0].event,s=0;s<n.length;s++)if("number"!=typeof n[s].days||n[s].days<0||n[s].days!=parseInt(n[s].days))return t.show("随访请输入正确时间"),!1;for(var l=0;l<n.length;l++){var u=[],d=[];if(n[l].article){if(n[l].article.length>=1)for(var p=0;p<n[l].article.length;p++)u.push(n[l].article[p].id)}else n[l].article=[];if(n[l].tool){if(n[l].tool.length>=1)for(var m=0;m<n[l].tool.length;m++)d.push(n[l].tool[m].id)}else n[l].tool=[];if(""==n[l].purpose||u.length<1&&d.length<1)return t.show("请检查信息后提交"),!1;r.push({days:n[l].days,purpose:n[l].purpose,article:u,tool:d})}"new"==e.operateType?(g.show(),i({method:"POST",url:c.getUrl("createFollowUpTemplatesStateController"),data:{title:a.dataArrFilter[0].title,event:r}}).success(function(e){g.hide(),e.result.success===!0?(globalTemplateData={},t.show("信息提交成功!"),history.go(-1)):t.show(e.result.displaymsg)})["catch"](function(t){o.err(t),g.hide()})):(g.show(),i({method:"PATCH",url:c.getUrl("updateTemplate",{id:e.operateType}),data:{templateId:parseInt(e.operateType),title:a.dataArrFilter[0].title,event:r}}).success(function(e){g.hide(),e.result.success===!0?globalTemplateData={}:t.show(e.displaymsg),t.show("信息提交成功!"),history.go(-1)}))},o.debug("setTemplateController"),o.info(a)}]}});var orderObjArr=[];app.directive("sortController",function(){return{restrict:"AE",templateUrl:"templates/controller/sortController.html",replace:!0,scope:{data:"=data",orderDate:"=date"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$stateParams","$$iconfont","$timeout","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){function f(e){var a=[];switch(e){case"orderObjArr":for(var r=0;r<orderObjArr.length;r++){a.push(orderObjArr[r].member.name),t.executorId.push(orderObjArr[r].member.id);for(var o=0;o<orderObjArr[r].delObj.length;o++)t.delIds.push(orderObjArr[r].delObj[o])}t.name=a.join("，");break;case"classArr":for(var n=0;n<classArr.length;n++)a.push(classArr[n].title),t.rosterId.push(classArr[n].id);t["class"]=a.join("，")}}t.rosterId=[],t.executorId=[],t.watchers=[],t.delIds=[],t.setDate=function(){try{var e=new Date;e.setFullYear(t.admissionTime.format("yyyy"),t.admissionTime.format("MM")-1,t.admissionTime.format("dd"));var a=new Date;a.setFullYear(2016,0,1);var r=new Date;r.setFullYear(2018,11,31),plus.nativeUI.pickDate(function(e){t.admissionTime=e.date,t.setAdmissionTime(),p(function(){t.$apply()},500)},function(t){},{title:"请选择日期",date:e,minDate:a,maxDate:r})}catch(o){}},$(".triggerInputWarp").on("click",".triggerInput",function(){$(this).find("input").focus()}),null!=admissionTime?"number"==typeof admissionTime?t.admissionTime=new Date(parseInt(admissionTime)):t.admissionTime=admissionTime:t.admissionTime=t.admissionTime||new Date,f("orderObjArr"),f("attentionObjArr"),f("classArr"),t.setAdmissionTime=function(){admissionTime=t.admissionTime},t.submitSchedules=function(){if(""==t.name||void 0===t.admissionTime||null===t.admissionTime||""==t["class"])return c.show("请检查信息后提交"),!1;var e;e=1==t.delIds.length?t.delIds[0]:t.delIds.length>1?t.delIds.join(","):"",""!=e&&void 0!=e&&null!=e?l({method:"DELETE",url:i.getUrl("dropSortSchedule",{rosterScheduleIds:e})}).success(function(a){a.result.success===!0&&(m.show(),l({method:"POST",url:i.getUrl("createSortScheduleStateController"),data:{rosterId:t.rosterId,executorId:t.executorId,date:Date.parse(t.admissionTime)}}).success(function(t){if(m.hide(),t.result.success===!0){orderObjArr=[],classArr=[],remindArr=[],e=[],c.show("修改排班成功"),"dutyCalendar"==sortType||"dutyChange"==sortType?history.go(-1):o.go("dutyCalendar");var a={time:0};localStorage.changeScheduleClassStateController=JSON.stringify(a),localStorage.batchSchedulesStateController=JSON.stringify(a),localStorage.changeSchedulePersonStateController=JSON.stringify(a)}else t.result.displaymsg?c.show(t.result.displaymsg):c.show("修改排班失败");r.debug("sorts"),r.info(t)}))}):(m.show(),l({method:"POST",url:i.getUrl("createSortScheduleStateController"),data:{rosterId:t.rosterId,executorId:t.executorId,date:Date.parse(t.admissionTime)}}).success(function(t){if(m.hide(),t.result.success===!0){orderObjArr=[],classArr=[],remindArr=[],e=[],c.show("排班成功"),"dutyCalendar"==sortType||"dutyChange"==sortType?history.go(-1):o.go("dutyCalendar");var a={time:0};localStorage.changeScheduleClassStateController=JSON.stringify(a),localStorage.batchSchedulesStateController=JSON.stringify(a),localStorage.changeSchedulePersonStateController=JSON.stringify(a)}else t.result.displaymsg?c.show(t.result.displaymsg):c.show("排班失败");r.debug("sorts"),r.info(t)}))},r.debug("sortController"),r.info(t)}]}});var templateTime="",followUpData={followObj:"",admissionTime:""};app.directive("startVisitController",function(){return{restrict:"AE",templateUrl:"templates/controller/startVisitController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$$loading","$timeout",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){t.targetId=[],t.executorId=[],t.runNurseObj=[],t.onPickDateClick=function(){try{var e=new Date;e.setFullYear(t.admissionTime.format("yyyy"),t.admissionTime.format("MM")-1,t.admissionTime.format("dd"));var a=new Date;a.setFullYear(2016,0,1);var r=new Date;r.setFullYear(2018,11,31),plus.nativeUI.pickDate(function(e){t.admissionTime=e.date,t.onAdmissionTimeChange(),p(function(){t.$apply()},500)},function(t){},{title:"请选择日期",date:e,minDate:a,maxDate:r})}catch(o){}},$(".triggerInputWarp").on("click",".triggerInput",function(){$(this).find("input").focus()}),"string"!=typeof templateTime?t.admissionTime=templateTime:t.admissionTime=t.admissionTime||new Date,t.targetId.push(followPatientObj.userId),t.followObj=followPatientObj.name,t.followtemplateId=templateObj.templateId,t.followTemplateObj=templateObj.title;for(var m=0;m<runNurseObjArr.length;m++)t.runNurseObj.push(runNurseObjArr[m].member.name),t.executorId.push(runNurseObjArr[m].member.id);remindArr.length>0?(t.alertTemplateId=remindArr[0].id,t.remind=remindArr[0].title):(t.alertTemplateId="",t.remind=""),t.onAdmissionTimeChange=function(){templateTime=t.admissionTime},t.onSaveFollowUpClick=function(){if(void 0==t.targetId[0]||t.executorId.length<1||""===t.alertTemplateId||""==t.followtemplateId||void 0==t.followtemplateId)return c.show("请检查信息后提交"),!1;g.show();var e=t.admissionTime.format("yyyy/MM/dd");l({method:"POST",url:i.getUrl("startFollowUpStateController"),data:{dischargeAt:Date.parse(new Date(e)),targetId:t.targetId,executorId:t.executorId,alertTemplateId:t.alertTemplateId,followUptemplateId:t.followtemplateId}}).success(function(t){g.hide(),t.result.success===!0&&(followPatientObj=[],templateObj=[],remindArr=[],templateTime=null,runNurseObjArr=[],c.show("发起成功"),o.go("messageTag")),r.debug("startVisitStateController"),r.info(t)})},r.debug("startVisitController"),r.info(t)}]}}),app.directive("writeRecordController",function(){return{restrict:"AE",templateUrl:"templates/controller/writeRecordController.html",replace:!0,scope:{data:"=data"},controller:["$scope","$element","$attrs","$$log","$state","$interval","$$txIM","$http","$$requestUrl","$$toast","$rootScope","$$iconfont","$stateParams","$timeout","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){t.event=t.data.event,t.actions=null,console.log(t.event);for(var f=0;f<t.event.length;f++)t.event[f].startTime=new Date(parseInt(t.event[f].startTime)).format("yyyy-MM-dd");t.stateButton=function(e){t.selIndex=t.selIndex==e?-1:e};for(var h=0;h<t.data.event.length;h++)g.eventId==t.data.event[h].id&&(t.selIndex=h);t.push=function(t){m.show(),l({method:"POST",url:i.getUrl("weiXinPushFollow"),data:t.wechat.content.msg}).success(function(e){e.result.success===!0?l({method:"PATCH",url:i.getUrl("updateFollowUpRecord",{id:t.id}),data:{eventId:t.id,purpose:t.purpose,brief:t.brief,wechat:{actionId:t.wechat.actionId,status:2}}}).success(function(e){m.hide(),e.result.success===!0&&(c.show("推送成功"),t.wechat.status=2)}):c.show("推送失败")})},t.completeFollowUp=function(t){""==t.purpose||""==t.brief.content?c.show("请检查信息后提交"):l({method:"PATCH",url:i.getUrl("updateFollowUpRecord",{id:t.id}),data:{eventId:t.id,purpose:t.purpose,brief:t.brief,wechat:{actionId:t.wechat.actionId,status:2},status:2}}).success(function(t){r.debug("writeRecordStateController"),r.info(t),t.result.success===!0&&(c.show("修改随访信息成功"),history.go(-1))})},t.setSelChat=function(t){l({method:"GET",url:i.getUrl("setChatFollowUp",{fromId:localStorage.globalNurseId,toId:t.personId}),params:{}}).success(function(t){localStorage.targetChatId=t.toAccount.identifier,r.debug("localStorage.targetChatId:  "+localStorage.targetChatId),location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat",r.debug("setChatFollowUp"),r.info(t)})}}]}});var nurseInfo={};app.controller("aletrNurseInfoStateController",["$$env","$$tabbar","$interval","$$requestUrl","$http","$$toast","$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","getData","$$loading","$$confirm",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m,f){function h(t){$(""+t+"-file").trigger("click"),$(""+t+"-img").bind("click",function(){
$(""+t+"-file").trigger("click")})}c.data=p.data,void 0!==nurseInfo.basic?(c.data=nurseInfo,c.data.occupation.certs.length>0?c.data.occupation.certs=JSON.stringify(c.data.occupation.certs):c.data.occupation.certs="",c.data.occupation.photocopy.length>0?c.data.occupation.photocopy=JSON.stringify(c.data.occupation.photocopy):c.data.occupation.photocopy=""):nurseInfo=c.data,"undefined"!=typeof p.data.basic&&p.data.basic.authorizedStatus>2?c.isPass=!0:c.isPass=!1,c.data.result.success&&(""===c.data.occupation.certs?c.data.occupation.certs=[{certNo:"",certName:"护士执业证书管理号"},{certNo:"",certName:"护士专业技术资格证书管理号"},{certNo:"",certName:""}]:(c.data.occupation.certs=JSON.parse(c.data.occupation.certs),c.data.occupation.certs.length<3&&c.data.occupation.certs.push({certNo:"",certName:""})),c.data.occupation.photocopy=""===c.data.occupation.photocopy?[]:JSON.parse(c.data.occupation.photocopy)),g.setTitle("优护助手 - 身份认证"),s.showReturnBtn(),e.setIndex(-1),c.isAlert=!1,c.setIsAlert=function(){c.isAlert=!c.isAlert},c.basic=c.data.basic,c.occupation=c.data.occupation,void 0!==aletrNurseInfoHospital.organizationId&&(c.basic.organizationName=aletrNurseInfoHospital.organizationName,c.basic.organizationId=aletrNurseInfoHospital.organizationId,c.basic.departmentName="",c.basic.departmentId=""),void 0!==aletrNurseInfoOffice.departmentName&&(c.basic.departmentName=aletrNurseInfoOffice.departmentName,c.basic.departmentId=aletrNurseInfoOffice.departmentId),c.count=0,c.checkPhone=function(){c.basic.phone.toString().length<11?n.show("输入的电话号码不正确"):o({method:"POST",url:r.getUrl("getAlertPhoneCaptcha"),data:{phone:c.basic.phone}}).success(function(t){t.result.success===!0?(c.count=60,c.count>0&&(c.countDown=a(function(){c.count--},1e3,60))):n.show(t.result.displayMsg)})},c.goChoiceHospital=function(){0==c.isPass&&i.go("choiceHospital")},c.goChoiceDepartment=function(){0==c.isPass&&i.go("choiceDepartment",{hospitalId:c.basic.organizationId})},c.delUrl=function(t){0==c.isPass&&f.show({title:"删除提示",msg:'<p style="text-align: center;">确定要删除该图片吗？</p>',callback:function(){for(var e=c.data.occupation.photocopy,a=0;a<e.length;a++)t==e[a]&&c.data.occupation.photocopy.splice(a,1);n.show("删除成功")},confirmText:"确定",cancelText:"取消"})},c.imgIndex=0,0==c.isPass&&($("#id-1").on("click",function(){var t=$(this).attr("id");h("#"+t),c.imgIndex=1}),$("#id-0-img").on("click",function(){$("#id-0-file").trigger("click"),c.imgIndex=0})),c.putCertificate=function(e){function a(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function r(t){var e=t.lastIndexOf(".");return t.substring(e+1)}var o,s;0===c.imgIndex?(o=document.getElementById("id-0-file").files[0],s=document.getElementById("id-0-file").files[0].name):(o=document.getElementById("id-1-file").files[0],s=document.getElementById("id-1-file").files[0].name);var l=r(s),i="avatar/"+a()+"."+l,u="",g="";1==t.getEnvirement()?(d.debug("dev 1"),u="yhjstatic-dev",g="http://yhjstatic-dev.oss-cn-shanghai.aliyuncs.com/"):2==t.getEnvirement()&&(d.debug("pro 2"),u="yhjstatic",g="http://yhjstatic.oss-cn-shanghai.aliyuncs.com/");var p=new OSS.Wrapper({region:"oss-cn-shanghai",accessKeyId:"LTAICadISGBAyskk",accessKeySecret:"TSnzCdIizqqW1QdW7VxbBJYStaMeZj",bucket:u});m.show(),p.multipartUpload(i,o).then(function(t){var e=g+t.name+"?x-oss-process=image/resize,h_500";0===c.imgIndex?(c.data.basic.avatarUrl=e,d.debug("url++"+c.data.basic.avatarUrl),c.$apply(),m.hide()):(c.data.occupation.photocopy.push(e),c.$apply(),m.hide(),$("#id-1-text").hide(),$("#id-2-text").show())})["catch"](function(t){m.hide(),n.show("上传失败！请重新上传"),d.debug(t)})},c.register=function(){for(var t=[],e=0;e<c.data.occupation.certs.length;e++)""!==c.data.occupation.certs[e].certNo&&""!==c.data.occupation.certs[e].certName&&t.push(c.data.occupation.certs[e]);""==c.data.basic.name?n.show("用户姓名不能为空"):(m.show(),o({method:"patch",url:r.getUrl("updateNurseInfo",{nurseId:localStorage.globalNurseId}),data:{basic:{id:parseInt(localStorage.globalNurseId),name:c.data.basic.name,avatarUrl:c.data.basic.avatarUrl,authorizedName:c.data.basic.authorizedName,authorizedStatus:parseInt(c.data.basic.authorizedStatus),departmentId:c.data.basic.departmentId,organizationId:c.data.basic.organizationId,organizationName:c.data.basic.organizationName,departmentName:c.data.basic.departmentName,professionalTitle:c.data.basic.professionalTitle},occupation:{IDNumber:c.data.occupation.IDNumber,certs:JSON.stringify(t),photocopy:JSON.stringify(c.data.occupation.photocopy)}}}).success(function(t){"undefined"!=typeof t.result&&m.hide(),t.result.success===!0?(n.show("数据提交成功"),nurseInfo={},history.go(-1)):n.show(t.result.displayMsg)}))}}]),app.controller("allPatientListStateController",["$stateParams","$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i,c){n.debug("allPatientListStateController"),n.debug(t.operateType),"show"==t.operateType?(s.setTitle("我的患者"),i.setIndex(1),c.hideReturnBtn()):(s.setTitle("选择随访对象"),i.setIndex(-1),c.showReturnBtn()),r.data=l.data,n.debug(l.data)}]),app.controller("alterNurseTagStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar","$stateParams","$http","$$requestUrl","$$confirm","$$toast","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){i.show(),i.setTitle("修改同事标签"),l.setIndex(-1),i.showReturnBtn(),a.data=s.data,a.dataArr=a.data,a.tagsArr=[],console.log(a.dataArr),void 0==a.dataArr.tag&&(a.dataArr.tag=[]);for(var f=0;f<a.dataArr.tag.length;f++){a.dataArr.tag[f].checked=!1;for(var h=0;h<checkedNurseTag.length;h++)a.dataArr.tag[f].tagId==checkedNurseTag[h]&&(a.dataArr.tag[f].checked=!0)}o.debug("$scope.dataArr.tag"),o.debug(a.dataArr.tag),a.checkTag=function(t){t.checked=!t.checked},a.newNurseTag=function(){g.show({title:"添加标签",msg:'<input class="h3 border-line border-color-global-base padding-left-md" style="width:80%;" type="text">',callback:function(){var t=[],e=$(".confirm").find("input").val();return""==e?(p.show("标签名不能为空！"),!1):(t.push({tagName:e}),void u({method:"POST",url:d.getUrl("createNurseTag"),data:{tag:t}}).success(function(t){if(1==t.result.success)for(var e=0;e<t.tag.length;e++)a.dataArr.tag.push(t.tag[e]),$(".confirm").find("input").val("");else p.show(t.result.displayMsg)}))},confirmText:"添加",cancelText:"取消"})},a.submitNurseTags=function(){m.show();for(var t=[],e=0;e<a.dataArr.tag.length;e++)a.dataArr.tag[e].checked===!0&&t.push({tagId:a.dataArr.tag[e].tagId});u({method:"PATCH",url:d.getUrl("updateNurseTags",{nurseId:c.nurseId}),data:{tag:t}}).success(function(t){if("undefined"==typeof t.result.success&&""==t.result.success||m.hide(),1==t.result.success){var e={time:0};localStorage.nurseList=JSON.stringify(e),p.show("标签修改完成！"),history.go(-1)}else p.show(t.result.displayMsg)})},i.showReturnBtn()}]),app.controller("basicInfoStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l){a.data="",n.setTitle("优护助手-身份认证"),s.setIndex(-1),l.showReturnBtn(),l.hideRightQRbtn(),l.show()}]),app.controller("beforeRecordStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$navbar","$$tabbar",function(t,e,a,r,o,n,s,l,i){a.data=s.data,o.debug("beforeRecordStateController"),o.info(a),l.setTitle("之前的随访"),i.setIndex(-1),l.showReturnBtn()}]),app.controller("blackListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar","getData",function(t,e,a,r,o,n,s,l,i){o.debug("blackListStateController"),a.data=i.data,n.setTitle("科室黑名单"),o.info(a),l.hide(),s.showReturnBtn()}]),app.controller("chatStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar",function(t,e,a,r,o,n,s,l){sessionStorage.imLoaded=!1,o.debug("chatStateController"),n.setTitle("聊天"),o.info(a),l.hide(),s.showReturnBtn()}]),app.controller("choiceClassStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$navbar","$$tabbar",function(t,e,a,r,o,n,s,l,i){a.data=s.data,o.debug("choiceClassStateController"),o.info(a),n.setTitle("选择班次"),l.showReturnBtn(),i.setIndex(-1)}]),app.controller("choiceColorStateController",["$$tabbar","$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","$$color",function(t,e,a,r,o,n,s,l,i){s.debug("choiceColorStateController"),s.info(o),l.setTitle("选择颜色"),e.showReturnBtn(),t.setIndex(-1)}]),app.controller("choiceDayStateController",["$$tabbar","$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","getData",function(t,e,a,r,o,n,s,l,i){o.data=i.data,s.debug("choiceDayStateController"),s.info(o),l.setTitle("选择提醒时间"),e.showReturnBtn(),t.setIndex(-1)}]),app.controller("choiceDepartmentStateController",["$$tabbar","$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","getData",function(t,e,a,r,o,n,s,l,i){o.data=i.data,l.setTitle("选择科室"),e.showReturnBtn(),t.setIndex(-1)}]),app.controller("choiceHospitalStateController",["$$tabbar","$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","getData",function(t,e,a,r,o,n,s,l,i){o.data=i.data,l.setTitle("选择所在医院"),e.showReturnBtn(),t.setIndex(-1)}]),app.controller("choiceVisitStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$stateParams","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i,c){switch(a.data=s.data,i.setIndex(-1),c.showReturnBtn(),l.operateType){case"show":n.setTitle("选择随访模板")}o.debug("choiceVisitStateController"),o.info(a)}]),app.controller("classListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$navbar","$$tabbar",function(t,e,a,r,o,n,s,l,i){a.data=s.data,o.debug("classListStateController"),o.info(a),n.setTitle("班次列表"),l.showReturnBtn(),i.setIndex(-1)}]);var newSelPushTemplate=[];app.controller("contentListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar","getData","$stateParams","$$txIM","$$toast","$http","$$requestUrl","$$iconfont","$$color","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m,f,h){function $(t){function e(t,e,r){switch(t){case"art":for(var o=0;o<e.articleGroup.length;o++)if(0===o?e.articleGroup[o].open=!0:e.articleGroup[o].open=!1,void 0!==e.articleGroup[o].article){for(var n=0;n<e.articleGroup[o].article.length;n++)for(var s=0;s<r.length;s++)r[s].id==e.articleGroup[o].article[n].id?e.articleGroup[o].article[n].sel=!0:e.articleGroup[o].article[n].sel=e.articleGroup[o].article[n].sel||!1;for(var l=e.articleGroup[o].article.length,i=0;i<e.articleGroup[o].article.length;i++)e.articleGroup[o].article[i].sel===!0&&(l-=1);l==e.articleGroup[o].article.length?e.articleGroup[o].sel=0:0===l?e.articleGroup[o].sel=2:e.articleGroup[o].sel=1}else o+=1;break;case"tool":for(var o=0;o<e.toolGroup.length;o++)if(0===o?e.toolGroup[o].open=!0:e.toolGroup[o].open=!1,void 0!==e.toolGroup[o].tool){for(var n=0;n<e.toolGroup[o].tool.length;n++)for(var s=0;s<r.length;s++)r[s].id==e.toolGroup[o].tool[n].id?e.toolGroup[o].tool[n].sel=!0:e.toolGroup[o].tool[n].sel=e.toolGroup[o].tool[n].sel||!1;for(var c=e.toolGroup[o].tool.length,i=0;i<e.toolGroup[o].tool.length;i++)e.toolGroup[o].tool[i].sel===!0&&(c-=1);c==e.toolGroup[o].tool.length?e.toolGroup[o].sel=0:0===c?e.toolGroup[o].sel=2:e.toolGroup[o].sel=1}else o+=1}if("art"==t){for(var u=!0,n=0;n<e.articleGroup.length;n++)if(2!=e.articleGroup[n].sel){u=!1;break}a.dataArr["cms-a"].sel=u}else{for(var d=!0,n=0;n<e.toolGroup.length;n++)if(2!=e.toolGroup[n].sel){d=!1;break}a.dataArr["cms-t"].sel=d}}switch(t){case"oldSelPushTemplate":0===oldSelPushTemplate.article.length&&0===oldSelPushTemplate.tool.length||(e("art",a.dataArr["cms-a"],oldSelPushTemplate.article),e("tool",a.dataArr["cms-t"],oldSelPushTemplate.tool))}}function b(t){var e=!0;if("art"==t)for(var r=0;r<a.dataArr["cms-a"].articleGroup.length;r++)if(void 0!==a.dataArr["cms-a"].articleGroup[r].article){for(var o=0;o<a.dataArr["cms-a"].articleGroup[r].article.length;o++)if(a.dataArr["cms-a"].articleGroup[r].article[o].sel!==!0){e=!1;break}a.dataArr["cms-a"].sel=e}else r+=1;else for(var r=0;r<a.dataArr["cms-t"].toolGroup.length;r++)if(void 0!==a.dataArr["cms-t"].toolGroup[r].tool){for(var o=0;o<a.dataArr["cms-t"].toolGroup[r].tool.length;o++)if(a.dataArr["cms-t"].toolGroup[r].tool[o].sel!==!0){e=!1;break}a.dataArr["cms-t"].sel=e}}if(a.colorTransform=f.transform,a.data=i.data,a.iconfont=m.init,o.debug("contentListStateController"),o.info(a.data),s.setTitle("选择推送内容"),s.showReturnBtn(),l.setIndex(-1),a.dataArr=a.data,o.debug("$scope.dataArr"),o.debug(a.dataArr),a.selectData={},void 0!==oldSelPushTemplate)$("oldSelPushTemplate");else{if(o.debug("进入"),"undefined"!=typeof a.dataArr["cms-t"].toolGroup)for(var S=0;S<a.dataArr["cms-t"].toolGroup.length;S++)0===S?a.dataArr["cms-t"].toolGroup[S].open=!0:a.dataArr["cms-t"].toolGroup[S].open=!1;if("undefined"!=typeof a.dataArr["cms-a"].articleGroup)for(var I=0;I<a.dataArr["cms-a"].articleGroup.length;I++)0===I?a.dataArr["cms-a"].articleGroup[I].open=!0:a.dataArr["cms-a"].articleGroup[I].open=!1}a.allCheck=function(t){if(o.debug(t),t.sel=2==t.sel?0:2,"art"==t.mark){if(void 0!==t.article){for(var e=0;e<t.article.length;e++)t.article[e].sel=2==t.sel;b("art")}}else if(void 0!==t.tool){for(var a=0;a<t.tool.length;a++)t.tool[a].sel=2==t.sel;b("tool")}o.debug(t.sel)},a.allCheckArticle=function(){a.dataArr["cms-a"].sel=a.dataArr["cms-a"].sel!==!0;for(var t=0;t<a.dataArr["cms-a"].articleGroup.length;t++)if(a.dataArr["cms-a"].sel)if(a.dataArr["cms-a"].articleGroup[t].sel=2,void 0!==a.dataArr["cms-a"].articleGroup[t].article)for(var e=0;e<a.dataArr["cms-a"].articleGroup[t].article.length;e++)a.dataArr["cms-a"].articleGroup[t].article[e].sel=!0;else t+=1;else if(a.dataArr["cms-a"].articleGroup[t].sel=0,void 0!==a.dataArr["cms-a"].articleGroup[t].article)for(var e=0;e<a.dataArr["cms-a"].articleGroup[t].article.length;e++)a.dataArr["cms-a"].articleGroup[t].article[e].sel=!1;else t+=1},a.allCheckTools=function(){a.dataArr["cms-t"].sel=a.dataArr["cms-t"].sel!==!0,o.info(a.dataArr);for(var t=0;t<a.dataArr["cms-t"].toolGroup.length;t++)if(a.dataArr["cms-t"].sel)if(a.dataArr["cms-t"].toolGroup[t].sel=2,void 0!==a.dataArr["cms-t"].toolGroup[t].tool)for(var e=0;e<a.dataArr["cms-t"].toolGroup[t].tool.length;e++)a.dataArr["cms-t"].toolGroup[t].tool[e].sel=!0;else t+=1;else if(a.dataArr["cms-t"].toolGroup[t].sel=0,void 0!==a.dataArr["cms-t"].toolGroup[t].tool)for(var e=0;e<a.dataArr["cms-t"].toolGroup[t].tool.length;e++)a.dataArr["cms-t"].toolGroup[t].tool[e].sel=!1;else t+=1},a.checkPush=function(t,e){o.debug(e),o.info(t),e.sel=!e.sel;var a=!0,r=!0;if("art"==t.mark)for(var n=0;n<t.article.length;n++)t.article[n].sel!==!0?a=!1:r=!1;else for(var s=0;s<t.tool.length;s++)t.tool[s].sel!==!0?a=!1:r=!1;a===!0?t.sel=2:r===!0?t.sel=0:t.sel=1,b(t.mark)},a.openClose=function(t){t.open=!t.open},a.submitPush=function(){function t(t){g({method:"GET",url:p.getUrl("createPatientChat",{fromId:localStorage.globalNurseId,toId:t})}).success(function(t){if(1==t.result.success)o.debug("和患者建立聊天成功！"),o.debug("createPatientNurseChatStateController.response"),o.info(t);else{var e=t.result.displayMsg;d.show(e.toString())}})}switch(pushPatient=pushPatient||[localStorage.targetChatId],o.debug("$scope.dataArr$scope.dataArr$scope.dataArr$scope.dataArr"),o.debug(a.dataArr),c.operateType){case"pushTemplate":for(var r=[],n=[],s=0;s<a.dataArr["cms-a"].articleGroup.length;s++)if(void 0!==a.dataArr["cms-a"].articleGroup[s].article)for(var l=0;l<a.dataArr["cms-a"].articleGroup[s].article.length;l++)a.dataArr["cms-a"].articleGroup[s].article[l].sel===!0&&r.push({id:a.dataArr["cms-a"].articleGroup[s].article[l].id,title:a.dataArr["cms-a"].articleGroup[s].article[l].name});else s+=1;for(var i=0;i<a.dataArr["cms-t"].toolGroup.length;i++)if(void 0!==a.dataArr["cms-t"].toolGroup[i].tool)for(var m=0;m<a.dataArr["cms-t"].toolGroup[i].tool.length;m++)a.dataArr["cms-t"].toolGroup[i].tool[m].sel===!0&&n.push({id:a.dataArr["cms-t"].toolGroup[i].tool[m].id,title:a.dataArr["cms-t"].toolGroup[i].tool[m].name});else i+=1;o.info("article"),o.debug(r);for(var f,$=[],s=0;s<r.length;s++){f=!0;for(var l=0;l<$.length;l++)if($[l].id==r[s].id){f=!1;break}f&&$.push(r[s])}for(var b,S=[],s=0;s<n.length;s++){b=!0;for(var l=0;l<S.length;l++)if(S[l].id==n[s].id){b=!1;break}b&&S.push(n[s])}if(0===newSelPushTemplate.length)newSelPushTemplate.push({article:$,tool:S,eventMark:oldSelPushTemplate.eventMark});else for(var I=0;I<newSelPushTemplate.length;I++)newSelPushTemplate[I].eventMark==oldSelPushTemplate.eventMark?newSelPushTemplate[I]={article:$,tool:S,eventMark:oldSelPushTemplate.eventMark}:newSelPushTemplate.push({article:$,tool:S,eventMark:oldSelPushTemplate.eventMark});o.debug("新选择的模版推送内容为:newSelPushTemplate"),o.debug(newSelPushTemplate),history.go(-1);break;case"patientPushObj":o.debug("pushPatientpushPatientpushPatient"),o.debug(pushPatient),o.debug("pushPatientId"),o.debug(pushPatientId),0==pushPatient.length&&""!==localStorage.targetChatId&&(pushPatient=[localStorage.targetChatId]);for(var v=[],y=[],C=[],s=0;s<a.dataArr["cms-a"].articleGroup.length;s++)if(void 0!==a.dataArr["cms-a"].articleGroup[s].article)for(var l=0;l<a.dataArr["cms-a"].articleGroup[s].article.length;l++)a.dataArr["cms-a"].articleGroup[s].article[l].sel===!0&&(C.push({id:a.dataArr["cms-a"].articleGroup[s].article[l].id,name:a.dataArr["cms-a"].articleGroup[s].article[l].name,desc:a.dataArr["cms-a"].articleGroup[s].article[l].brief,img:a.dataArr["cms-a"].articleGroup[s].article[l].iconUrl,type:"[康复文章]"}),v.push(a.dataArr["cms-a"].articleGroup[s].article[l].id));else s+=1;for(var i=0;i<a.dataArr["cms-t"].toolGroup.length;i++)if(void 0!==a.dataArr["cms-t"].toolGroup[i].tool)for(var m=0;m<a.dataArr["cms-t"].toolGroup[i].tool.length;m++)a.dataArr["cms-t"].toolGroup[i].tool[m].sel===!0&&(C.push({id:a.dataArr["cms-t"].toolGroup[i].tool[m].id,name:a.dataArr["cms-t"].toolGroup[i].tool[m].name,desc:a.dataArr["cms-t"].toolGroup[i].tool[m].brief,img:a.dataArr["cms-t"].toolGroup[i].tool[m].iconUrl,type:"[康复工具]"}),y.push(a.dataArr["cms-t"].toolGroup[i].tool[m].id));else i+=1;for(var T,w=[],s=0;s<C.length;s++){T=!0;for(var l=0;l<w.length;l++)if(w[l].id===C[s].id){T=!1;break}T===!0&&w.push(C[s])}for(var f,A=[],s=0;s<v.length;s++){f=!0;for(var l=0;l<A.length;l++)if(A[l]==v[s]){f=!1;break}f===!0&&A.push(v[s])}for(var b,N=[],s=0;s<y.length;s++){b=!0;for(var l=0;l<N.length;l++)if(N[l]==y[s]){b=!1;break}b===!0&&N.push(y[s])}if(o.info("-------------"),o.debug(w),o.debug(A),o.debug(N),0===w.length)d.show("请选择想要推送的内容");else{h.show(),u.initImArrayAndSend(pushPatient,w,!0);for(var s=0;s<pushPatientId.length;s++)t(pushPatientId[s]);g({method:"POST",url:p.getUrl("createPatientsWeiXinPush"),data:{fromId:localStorage.globalNurseId,toChatIdentifiers:pushPatient,articleIds:A,toolIds:N,departmentId:localStorage.globalDepartmentId}}).success(function(t){function a(t){location.href=t}if("undefined"!=typeof t.result.success&&h.hide(),t.result.success===!0)if(1==pushPatient.length)localStorage.targetChatId=pushPatient[0],pushPatient=[],e.go("chat");else{pushPatient=[];var r=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/messageTag";o.debug(r),a(r)}})}}}}]),app.controller("createCalenderStateController",["$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar",function(t,e,a,r,o,n,s,l){n.debug("createCalenderStateController"),n.info(r),s.setTitle("新建日程"),l.setIndex(-1),t.showReturnBtn()}]),app.controller("dutyCalendarStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$stateParams","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i,c){a.data=s.data,o.debug(l),a.weekOffset=""===l.weekOffset?0:l.weekOffset,o.debug("dutyCalendarStateController"),o.info(a),n.setTitle("查看排班表"),c.showReturnBtn(),i.setIndex(-1)}]),app.controller("dutyChangeStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$stateParams","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i,c,u){a.data=s.data,a.weekOffset=""===l.weekOffset?0:l.weekOffset,o.debug("dutyChangeStateController"),o.info(a),n.setTitle("查看排班表"),c.showReturnBtn(),i.setIndex(-1)}]),app.controller("dutyListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$stateParams","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i,c){a.data=s.data,a.weekOffset=""===l.weekOffset?0:l.weekOffset,o.debug("dutyListStateController"),o.info(a),a.nowTimeDay=(new Date).format("yyyy-MM-dd").split("-")[1],console.log(a.nowTimeDay),c.showReturnBtn(),i.setIndex(-1)}]);var globalTemplateData={};app.controller("editVisitStateController",["$rootScope","$state","$scope","$location","$$log","$$tabbar","$$navbar","$$title","getData","$stateParams",function(t,e,a,r,o,n,s,l,i,c){switch(a.data=i.data,newSelPushTemplate=[],globalTemplateData={},c.operateType){case"show":l.setTitle("编辑随访模板");break;case"add":l.setTitle("管理随访模板")}n.setIndex(-1),s.showReturnBtn(),o.debug("editVisitStateController"),o.info(a)}]),app.controller("fakeMainPageStateController",["$$confirm","$$toast","$state","$scope","$$log","$$title","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l){r.toLogin=function(){t.show({title:"尚未登录",msg:"请登录后进行操作",callback:function(){a.go("login")},confirmText:"登录",cancelText:"取消"})},o.debug("fakeMainPageStateController"),o.info(r),n.setTitle("优护助手"),l.show(),s.setIndex(0),l.hideReturnBtn()}]),app.controller("guidePageStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar","$$shence",function(t,e,a,r,o,n,s,l,i){i.track("_guidePageStateController",{appStoreName:appStoreName}),localStorage.guided="true",l.hide(),s.hide()}]),app.controller("inputConfirmDemo",["$$confirm","$timeout","$$loading","$$toast","$$navbar",function(t,e,a,r,o){e(function(){o.setTitle("test"),o.showReturnBtn(),t.show({title:"confirm",msg:'<input class="h3 border-line border-color-global-base" type="text">',callback:function(){r.show("confirm clicked",function(){a.show()})},confirmText:"confirm",cancelText:"cancel"})})}]),app.controller("inviteNurseStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$http","$$requestUrl","$$toast","$$navbar","$$tabbar",function(t,e,a,r,o,n,s,l,i,c,u){a.headImgUrl=headImgUrl,c.setTitle("邀请同事"),c.showReturnBtn(),u.setIndex(-1),a.inviteNurse=function(){return a.nurseId=1,void 0==a.nursePhone||null==a.nursePhone?(i.show("不能为空"),!1):a.nursePhone.toString().length<11?(i.show("请检查信息后提交"),!1):(a.phone=a.nursePhone.toString(),void s({method:"post",url:l.getUrl("createInviteNurse",{nurseId:localStorage.globalNurseId}),data:{phone:a.phone.toString()}}).success(function(t){1==t.result.success?i.show("发送短信邀请成功！"):i.show(t.result.displayMsg)}))}}]),app.controller("loginStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar",function(t,e,a,r,o,n,s,l){l.setIndex(-1),s.hide()}]),app.controller("manageStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i){o.debug("manageStateController"),o.info(a),i.track("manageStateController"),l.setTitle("管理"),l.show(),s.setIndex(-1),l.showReturnBtn()}]),app.controller("messageTagStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i,c){sessionStorage.imLoaded=!1,l.setNewMsg(0,!1),a.data=s.data,a.notify=[],a.calendar=[],a.onAddClick=function(){c.track("_messageTagStateControllerAdd")},a.gotoPage=function(t){location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/"+t};var u;for(u=0;void 0!=a.data.today&&u<a.data.today.length;u++)a.notify.push(a.data.today[u].title);for(u=0;void 0!=a.data.expire&&u<a.data.expire.length;u++)a.notify.push(a.data.expire[u].title);for(u=0;void 0!=a.data.future&&u<a.data.future.length;u++)a.notify.push(a.data.future[u].title);for(u=0;void 0!=a.data.roster&&u<a.data.roster.length;u++)a.calendar.push(a.data.roster[u].title);a.calendar=a.calendar.join(" "),o.debug("messageTagStateController"),o.info(a),n.setTitle("优护助手"),i.show(),l.setIndex(0),i.hideReturnBtn()}]);var nurseDetail="",checkedNurseTag=[];app.controller("nurseDetailStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar","getData","$stateParams","$http","$$requestUrl","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g){checkedNurseTag=[],s.showReturnBtn(),l.setIndex(-1),a.data=i.data,a.filterJuge=c.nurseId;for(var p=0;p<a.data.all.length;p++)if(a.data.all[p].nurseId==a.filterJuge){nurseDetail=a.data.all[p];break}if(s.setTitle(nurseDetail.name?nurseDetail.name:"同事详情页"),"undefined"!=typeof nurseDetail.tag)for(var m=0;m<nurseDetail.tag.length;m++)checkedNurseTag.push(nurseDetail.tag[m].tagId);if(a.ownNurseId=localStorage.globalNurseId,a.nurseInfo=nurseDetail,a.tagStr="",void 0!=a.nurseInfo.tag)for(var p=0;p<a.nurseInfo.tag.length;p++)p<a.nurseInfo.tag.length-1?a.tagStr=a.tagStr+a.nurseInfo.tag[p].tagName+"，":a.tagStr=a.tagStr+a.nurseInfo.tag[p].tagName;classArr=[],orderObjArr=[],remindArr=[],admissionTime=null,a.goToSort=function(t){var a={member:{id:t.nurseId,name:t.name},delObj:[]};orderObjArr=[a],e.go("sort",{operateType:"alert"})},a.gotoChat=function(t){g.show(),u({method:"GET",url:d.getUrl("createNurseChat",{fromId:localStorage.globalNurseId,toId:c.nurseId})}).success(function(t){g.hide(),1==t.result.success?(o.debug("和护士建立聊天成功！"),localStorage.targetChatId=t.toAccount.identifier,location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat",o.debug("createNurseNurseChatStateController"),o.info(t)):$$toast.show(t.result.displayMsg?t.result.displayMsg:"服务器向你扔来了一个错误")})}}]);var orderObjArr=[],attentionObjArr=[],runNurseObjArr=[];app.controller("nurseListStateController",["$$toast","$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar","getData","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u){function d(t){if(n.debug("默认选中的数组"),n.debug(t),0==t.length)return n.debug("selArr === null"),!1;for(var e=0;e<r.dataArr.all.length;e++)for(var a=0;a<t.length;a++)r.dataArr.all[e].nurseId==t[a].member.id?r.dataArr.all[e].sel=!0:r.dataArr.all[e].sel=r.dataArr.all[e].sel||!1;for(var o=!0,e=0;e<r.dataArr.all.length;e++){if(1!=r.dataArr.all[e].sel){o=!1;break}o=!0}r.dataArr.all.sel=o}if(r.data=c.data,r.open=!0,"undefined"==typeof r.data)return n.debug("服务器返回的数据为空"),t.show("服务器返回数据为空"),!1;if(r.dataArr=r.data,r.operateType=u.operateType,l.showReturnBtn(),i.setIndex(-1),r.ownNurseId=localStorage.globalNurseId,"undefined"!=typeof r.dataArr.nurse)for(var g=0;g<r.dataArr.nurse.length;g++)r.dataArr.nurse[g].memberNum=r.dataArr.nurse[g].member.length;switch(u.operateType){case"show":l.setTitle("我的同事");break;case"selectOrder":l.setTitle("选择排班对象"),d(orderObjArr);break;case"selectAttention":l.setTitle("选择关注对象"),d(attentionObjArr);break;case"selectRunNurse":l.setTitle("选择执行护士"),d(runNurseObjArr)}r.openCloseAll=function(){r.open=!r.open},r.openClose=function(t){t.open=!t.open},r.allCheck=function(){r.dataArr.all.sel=!r.dataArr.all.sel;for(var t=0;t<r.dataArr.all.length;t++)r.dataArr.all[t].sel=r.dataArr.all.sel},r.allNurseCheck=function(t){t.sel=!t.sel;for(var e=0;e<t.member.length;e++)t.member[e].sel=t.sel},r.checkNurseSelf=function(t,e){t.sel=!t.sel,e.sel=!0;for(var a=0;a<e.member.length;a++)if(1!=e.member[a].sel){e.sel=!1;break}},r.checkSelf=function(t){t.sel=!t.sel;for(var e=!0,a=0;a<r.dataArr.all.length;a++)if(1!=r.dataArr.all[a].sel){e=!1;break}r.dataArr.all.sel=e},r.setNurseArr=function(){n.debug(r.dataArr),r.nurseObjArr=[],n.debug(r.nurseObjArr);for(var e=0;e<r.dataArr.all.length;e++)if(1==r.dataArr.all[e].sel){var a={name:r.dataArr.all[e].name,id:r.dataArr.all[e].nurseId},o={member:a,delObj:[]};r.nurseObjArr.push(o)}if(void 0!=r.dataArr.nurse)for(var e=0;e<r.dataArr.nurse.length;e++)for(var s=0;s<r.dataArr.nurse[e].member.length;s++)if(1==r.dataArr.nurse[e].member[s].sel){var a={name:r.dataArr.nurse[e].member[s].name,id:r.dataArr.nurse[e].member[s].nurseId},o={member:a,delObj:[]};r.nurseObjArr.push(o)}for(var l,i=[],e=0;e<r.nurseObjArr.length;e++){l=!0;for(var s=0;s<i.length;s++)if(i[s].member.id==r.nurseObjArr[e].member.id){l=!1;break}l&&i.push(r.nurseObjArr[e])}switch(r.nurseObjArr=i,r.operateType){case"selectOrder":orderObjArr=r.nurseObjArr;break;case"selectAttention":attentionObjArr=r.nurseObjArr,n.debug(attentionObjArr);break;case"selectRunNurse":runNurseObjArr=r.nurseObjArr}0==r.nurseObjArr.length?t.show("没有选择同事,请至少选择一个"):(n.debug("选择的同事对象"),n.debug(r.nurseObjArr),history.go(-1))}}]),app.controller("nursePlanCounterStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence","getData",function(t,e,a,r,o,n,s,l,i,c){a.data=c.data,o.debug("nursePlanCounterStateController"),o.info(a),i.track("nursePlanCounterStateController"),n.setTitle("康复计划统计"),l.show(),s.setIndex(-1),l.showReturnBtn()}]),app.controller("nurseTagManageStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i){o.debug("nurseTagManageStateController"),o.info(a),i.show(),i.setTitle("护士标签"),l.setIndex(-1),i.showReturnBtn(),a.data=s.data}]),app.controller("nurseToolCounterStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence","getData",function(t,e,a,r,o,n,s,l,i,c){a.data=c.data,o.debug("nursePlanCounterStateController"),o.info(a),i.track("nurseToolCounterStateController"),n.setTitle("康复工具统计"),l.show(),s.setIndex(-1),l.showReturnBtn()}]),app.controller("otherPatientListStateController",["$$shence","$rootScope","$state","$scope","$location","$$log","$$title","getData","$$navbar","$$tabbar","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u){if(r.data=l.data,n.debug("otherPatientListStateController"),n.debug(r.data),r.dataArr=r.data.user,"true"==u.isIn){t.track("_getInHospitalPatientList"),n.debug(u.isIn),i.setTitle("住院患者"),r.isIn=1,r.inLength=0;for(var d=0;d<r.dataArr.length;d++)for(var g=0;g<r.dataArr[d].member.length;g++)1==r.dataArr[d].member[g].status&&r.inLength++;n.debug("inLength"+r.inLength)}else{t.track("_getOutHospitalPatientList"),n.debug(u.isIn),i.setTitle("已出院患者"),r.isIn=0,n.debug("otherPatientListStateController"),r.outLength=0;for(var d=0;d<r.dataArr.length;d++)for(var g=0;g<r.dataArr[d].member.length;g++)0==r.dataArr[d].member[g].status&&r.outLength++;n.debug("outLength"+r.outLength)}n.info(r),i.showReturnBtn(),c.setIndex(-1)}]);var patientInfo={};app.controller("patientDetailStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$navbar","$$tabbar","$stateParams","$$confirm","$$toast","$http","$$requestUrl","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){if(a.data=s.data,a.dataArr=a.data,a.patientId=c.patientId,o.debug("personalInformationStateController"),o.debug(a.patientId),o.info(a),l.setTitle("患者姓名"),l.showReturnBtn(),i.setIndex(-1),a.searchKey="",o.debug("$scope.dataArr.tag"),o.debug(a.dataArr),o.debug(a.dataArr.tag),a.isTag=function(t){if(o.debug(t),o.debug("undefined"!=typeof t.tagCategoryName),"undefined"!=typeof t.tagCategoryName)return t.tagCategoryName.indexOf(a.searchKey)>-1},void 0!=a.data.departmentTag||void 0!=a.data.departmentTag.tag)for(var f=0;f<a.data.departmentTag.tag.length;f++){for(var h=0;h<a.data.departmentTag.tag[f].tag.length;h++){a.data.departmentTag.tag[f].tag[h].isShow=!0;var b=0;a.data.departmentTag.tag[f].tag[h].tagType<2&&b++,o.debug("flag"+b),o.debug("$scope.data.tag[j].tag[k].length"+a.data.departmentTag.tag[f].tag.length),b>0?a.data.departmentTag.tag[f].isShow=!0:a.data.departmentTag.tag[f].isShow=!1}var S=0;0==a.data.departmentTag.tag[f].isShow&&S++,S==a.data.departmentTag.tag.length&&(a.data.departmentTag.tag.length=0)}if(a.onClearInput=function(){
a.searchKey=""},a.onIsSearchStatus=function(t){a.isSearch=t,0==a.isSearch?a.searchKey="":$(".searchInput").focus()},"undefined"!=typeof a.dataArr.tag&&"undefined"!=typeof a.dataArr.departmentTag.tag){for(var I=0;I<a.dataArr.tag.length;I++){2==a.dataArr.tag[I].tagType&&a.dataArr.tag[I].tagName==localStorage.globalNurseId&&(a.isAttention=!0);for(var f=0;f<a.dataArr.departmentTag.tag.length;f++)if(a.dataArr.tag[I].tagCategoryId==a.dataArr.departmentTag.tag[f].tagCategoryId){o.debug("同一个类");for(var h=0;h<a.dataArr.departmentTag.tag[f].tag.length;h++)a.dataArr.tag[I].tagId==a.dataArr.departmentTag.tag[f].tag[h].tagId?a.dataArr.departmentTag.tag[f].tag[h].sel=!0:a.dataArr.departmentTag.tag[f].tag[h].sel=a.dataArr.departmentTag.tag[f].tag[h].sel===!0||!1}}o.debug("$scope.dataArr"),o.debug(a.dataArr)}a.onMoreOperationClick=function(){patientInfo=a.data,e.go("patientRelation")},a.addTag=function(t){u.show({title:"添加标签",msg:'<input class="h3 border-line border-color-global-base padding-left-md" style="width:80%;" type="text">',callback:function(){o.debug(t);var e=t.tagCategoryId,r=$(".confirm").find("input").val(),n=[{tagName:r,tagCategoryId:e}];o.debug("tagsObj"),o.debug(n),""!=r?(m.show(),g({method:"POST",url:p.getUrl("createPatientCategoryTag"),data:{tag:n}}).success(function(t){if("undefined"!=t.result.success&&m.hide(),t.result.success===!0){for(var e=0;e<t.tag.length;e++)for(var r=0;r<a.dataArr.departmentTag.tag.length;r++)a.dataArr.departmentTag.tag[r].tagCategoryId==t.tag[e].tagCategoryId&&a.dataArr.departmentTag.tag[r].tag.push({tagId:t.tag[e].tagId,tagName:t.tag[e].tagName,tagCategoryId:t.tag[e].tagCategoryId,tagCategoryName:t.tag[e].tagCategoryId,tagType:t.tag[e].tagType});o.debug("$scope.dataArr.departmentTag"),o.debug(a.dataArr.departmentTag.tag),$(".confirm").find("input").val("")}else{var n=t.result.displayMsg;d.show(n.toString())}return o.debug("createPatientCategoryTag"),o.info(t),t})):d.show("数据项不能为空")},confirmText:"确定",cancelText:"取消"})},a.addCategory=function(){u.show({title:"添加分类",msg:'<label for="tagCategoryName">分类：</label><input style="margin-bottom:0.64rem;" id="tagCategoryName" class="h3 border-line border-color-global-base padding-left-md" type="text"><br/><label for="tagCategoryName">标签：</label><input id="tagName" class="h3 border-line border-color-global-base padding-left-md" type="text">',callback:function(){var t=$(".confirm").find("#tagCategoryName").val(),e=$(".confirm").find("#tagName").val();o.debug(t),o.debug(e);var r=[{tagId:null,tagName:e,tagCategoryId:null,tagCategoryName:t}];o.debug("categoriesArr"),o.debug(r),""!=t&&""!=e?(m.show(),g({method:"POST",url:p.getUrl("createPatientTagCategory"),data:{tag:r}}).success(function(t){if(1==t.result.success){if(m.hide(),t.tag.length>0)for(var e=0;e<t.tag.length;e++)if("undefined"==typeof a.dataArr.departmentTag.tag)a.dataArr.departmentTag.tag=[{tag:[{tagId:t.tag[e].tagId,tagName:t.tag[e].tagName,tagCategoryId:t.tag[e].tagCategoryId,tagCategoryName:t.tag[e].tagCategoryId,tagType:t.tag[e].tagType}],tagCategoryId:t.tag[e].tagCategoryId,tagCategoryName:t.tag[e].tagCategoryName,isShow:!0}],o.debug("当前用户的$scope.dataArr.departmentTags为空，添加后的$scope.dataArr.departmentTags："),o.debug(a.dataArr.departmentTag);else for(var r=0;r<t.tag.length;r++)a.dataArr.departmentTag.tag.push({tag:[{tagId:t.tag[r].tagId,tagName:t.tag[r].tagName,tagCategoryId:t.tag[e].tagCategoryId,tagCategoryName:t.tag[e].tagCategoryId,tagType:t.tag[e].tagType}],tagCategoryId:t.tag[r].tagCategoryId,tagCategoryName:t.tag[r].tagCategoryName,isShow:!0})}else{var n=t.result.displayMsg;d.show(n.toString())}$(".confirm").find("#tagCategoryName").val(""),$(".confirm").find("#tagName").val(""),o.debug("createPatientTagCategory.response"),o.info(t)})):d.show("数据项不能为空")},confirmText:"确定",cancelText:"取消"})},a.setSelfChat=function(){o.debug("建立聊天"),g({method:"GET",url:p.getUrl("createPatientChat",{fromId:localStorage.globalNurseId,toId:a.patientId})}).success(function(t){if(1==t.result.success)o.debug("和患者建立聊天成功！"),localStorage.targetChatId=t.toAccount.identifier,location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat",o.debug("createPatientNurseChatStateController.response"),o.info(t);else{var e=t.result.displayMsg;d.show(e.toString())}})},a.gotoPush=function(){localStorage.targetChatId=a.data.identifier,pushPatient=[localStorage.targetChatId],o.debug("gotoPush"),e.go("contentList",{operateType:"patientPushObj"})},a.alertTag=function(t){m.show();var e="undefined"!=typeof a.dataArr.tag?a.dataArr.tag:[];if(1==t.sel){o.debug("del : 对该名患者已有的标签删除");for(var r=0;r<a.dataArr.tag.length;r++)t.tagId==a.dataArr.tag[r].tagId&&e.splice(r,1);o.debug(e)}else o.debug("add : 给该名患者添加标签"),e.push({tagId:t.tagId,tagName:t.tagName}),o.debug(e);g({method:"PATCH",url:p.getUrl("updatePatientTag",{userId:c.patientId}),data:{tag:e}}).success(function(e){if("undefined"!=typeof e.result.success&&m.hide(),1==e.result.success){var r={time:0};localStorage.allPatientList=JSON.stringify(r),o.debug("localStorage['allPatientList']:"+localStorage.allPatientList),t.sel=!t.sel,o.debug("response"),o.debug(e),a.dataArr.tag=e.tag,o.debug("updatePatientTag.response"),o.info(e)}else{var n=e.result.displayMsg;d.show(n.toString())}})}}]),app.controller("patientListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i){o.debug("patientListStateController"),o.info(a),i.show(),i.setTitle("我的患者"),l.setIndex(1),i.hideReturnBtn(),a.data=s.data,a.dataArr={}}]),app.controller("patientRelationStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l){o.info(a),n.setTitle("更多"),s.setIndex(-1),l.showReturnBtn()}]),app.controller("patientTagManageStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i){o.debug("patientTagManageStateController"),o.info(a),i.show(),i.setTitle("患者标签"),l.setIndex(-1),i.showReturnBtn(),a.data=s.data}]);var pushPatient=[],pushPatientId=[];app.controller("patientTagStateController",["$stateParams","$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar","$http","$$requestUrl","$$toast","$$confirm","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){switch(r.data=l.data,r.dataArr=r.data,n.debug("patientTagStateController"),n.info(r.dataArr),c.setTitle("患者"),c.showReturnBtn(),i.setIndex(-1),i.hide(),pushPatient=[],pushPatientId=[],r.tagArr=[],r.seacheArr=[],r.showResult=!1,n.debug("对页面的操作类型为"+t.operateType),t.operateType){case"communicate":r.show="communicate";break;case"push":r.show="push"}r.delSeaTag=function(t){n.info("---seacheArr---tag---"),n.debug("tag"),n.debug(t),n.debug("$scope.seacheArr"),n.debug(r.seacheArr),n.debug("$scope.showResult"+r.showResult);for(var e=0;e<r.dataArr.tag.length;e++)for(var a=0;a<r.dataArr.tag[e].tag.length;a++)r.dataArr.tag[e].tag[a].isActive=!1;for(var o=0;o<r.seacheArr.length;o++)r.seacheArr[o].tagMember.tagId==t.tagMember.tagId&&t.tagCategoryId==r.seacheArr[o].tagCategoryId&&(n.debug("del"),r.seacheArr.splice(o,1),0==r.seacheArr.length&&(r.showResult=!1,g.show("请选择标签"),m.hide(),n.debug("$scope.seacheArr"),n.debug(r.seacheArr),n.debug(r.seacheArr==[])));for(var o=0;o<r.seacheArr.length;o++)for(var e=0;e<r.dataArr.tag.length;e++)for(var a=0;a<r.dataArr.tag[e].tag.length;a++)r.dataArr.tag[e].tag[a].tagId==r.seacheArr[o].tagMember.tagId&&(r.dataArr.tag[e].tag[a].isActive=!0);if(n.debug(r.seacheArr),0!=r.seacheArr.length&&r.showResult){m.show(),n.debug("改变筛选条件，发送请求");var s=[];0!=s.length&&(s=[]);for(var e=0;e<r.seacheArr.length;e++)s.push(r.seacheArr[e].tagMember.tagId);u({method:"GET",url:d.getUrl("getTagPatientList",{nurseId:localStorage.globalNurseId}),params:{tag:s.join(",")}}).success(function(t){if("undefined"!=typeof t.result.success&&m.hide(),t.result.success===!0)r.showResult=!0,r.userData=t.user,n.debug(r.userData);else{n.debug("服务器返回错误");var e=t.result.displayMsg;g.show(e.toString())}n.debug("getTagPatientList.response"),n.info(t)})}},r.alertSeach=function(t,e){if(e.isActive=!e.isActive,e.isActive===!0)r.seacheArr.push({tagCategoryId:t.tagCategoryId,tagMember:e}),n.debug(r.seacheArr);else{for(var a=0;a<r.seacheArr.length;a++)r.seacheArr[a].tagMember.tagId==e.tagId&&r.seacheArr.splice(a,1);n.debug("del")}},r.tagSeacher=function(){n.debug(r.seacheArr);for(var t=[],e=0;e<r.seacheArr.length;e++)t.push(r.seacheArr[e].tagMember.tagId);n.debug("seacheArrTags"),n.debug(t),0===r.seacheArr.length?g.show("请输入筛选条件"):(m.show(),n.debug(t),n.debug("seacheArrTags",t.join(",")),u({method:"GET",url:d.getUrl("getTagPatientList",{nurseId:localStorage.globalNurseId}),params:{tag:t.join(",")}}).success(function(t){if("undefined"!=t.result.success&&m.hide(),t.result.success===!0)r.showResult=!0,r.userData=t.user;else{var e=t.result.displayMsg;g.show(e.toString())}n.debug("tagPatientList.response"),n.info(t),n.debug(r.seacheArr)}))},r.returnAddTag=function(){r.showResult=!1},r.allCheck=function(t){t.sel=2==t.sel?0:2;for(var e=0;e<t.length;e++)for(var a=0;a<t[e].member.length;a++)t[e].member[a].sel=2==t.sel},r.checkSelf=function(t){},r.pushPatient=function(){n.debug("userData"),n.debug(r.userData);for(var t=0;t<r.userData.length;t++)for(var e=0;e<r.userData[t].member.length;e++)pushPatient.push(r.userData[t].member[e].identifier),pushPatientId.push(r.userData[t].member[e].userId);n.debug("pushPatient"),n.debug(pushPatient),n.debug(pushPatientId),a.go("contentList",{operateType:"patientPushObj"})},r.setCommunicate=function(){n.debug("userData"),n.debug(r.userData),r.resultArr=[];for(var t=0;t<r.userData.length;t++)for(var e=0;e<r.userData[t].member.length;e++)r.resultArr.push(r.userData[t].member[e]);return 0===r.resultArr.length?(g.show("请选择沟通对象"),!1):void(r.resultArr.length>1?p.show({title:"请输入群聊名称",msg:'<input class="h3 border-line border-color-global-base" type="text">',callback:function(){var t=$(".confirm").find("input").val(),e=[parseInt(localStorage.globalNurseId)],a=[];r.groupName=t,n.debug("群聊名称"),n.debug(r.groupName);for(var o=0;o<r.resultArr.length;o++)a.push(r.resultArr[o].userId);n.debug("--------------"),n.debug(a),u({method:"POST",url:d.getUrl("createGroupChat"),data:{groupName:r.groupName,nurseIds:e,userIds:a}}).success(function(t){"undefined"!=typeof t.result.success&&m.hide(),t.result.success===!0?localStorage.targetChatId=t.groupId:g.show(t.result.displayMsg.toString()),location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat"}),n.debug("群聊数组"),n.debug(r.resultArr)},confirmText:"确定",cancelText:"取消"}):(n.debug("单聊数组"),n.debug(r.resultArr),u({method:"POST",url:d.getUrl("createC2CUser",{fromId:localStorage.globalNurseId,toId:r.resultArr[0].userId})}).success(function(t){"undefined"!=typeof t.result.success&&m.hide(),t.result.success===!0?localStorage.targetChatId=t.toAccount.identifier:g.show(t.result.displayMsg.toString()),location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat"})))}}]),app.controller("professionInfoStateController",["$$navbar","$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar",function(t,e,a,r,o,n,s,l){r.data="",n.debug("professionInfoStateController"),n.info(r),s.setTitle("优护助手-身份认证"),l.setIndex(-1),t.showReturnBtn(),t.setRightBtnShow(3,"跳过")}]);var content={};app.controller("recentCalenderStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i,c){a.data=s.data,a.parseDateExpire=function(t){return new Date(t.startTime).format("MM月dd日")},a.onAddClick=function(){o.debug("onAddClick"),c.track("_recentCalenderStateControllerAdd")},a.parseDateToday=function(t){return"00:00"==new Date(t.startTime).format("hh:mm")&&"23:59"==new Date(t.endTime).format("hh:mm")?"全天":new Date(t.startTime).format("hh:mm")+"-"+new Date(t.endTime).format("hh:mm")},a.parseDateFuture=function(t){var e=new Date(t.startTime).format("dd"),a=new Date(t.endTime).format("dd");return e==a?new Date(t.startTime).format("MM月dd日"):new Date(t.startTime).format("MM月dd日")+"  跨"+(Math.floor((t.endTime-t.startTime)/1e3/60/60/24)+1)+"天"},o.debug("recentCalenderStateController"),o.info(a),n.setTitle("日程"),l.setIndex(-1),i.showReturnBtn()}]),app.controller("selectListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","getData","$$navbar","$$tabbar","$stateParams","$$confirm","$$toast","$http","$$requestUrl","$$loading",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p,m){function f(){location.href=location.origin+location.pathname+"?"+parseInt(1e3*Math.random())+"#/chat"}if(o.debug("selectListStateController"),o.info(a),l.setTitle("选择沟通的对象"),l.showReturnBtn(),i.setIndex(-1),a.allNursesData=s.nurse.data.all,a.nurseData=void 0===s.nurse.data.nurse?[]:s.nurse.data.nurse,o.debug("getData.patient.user"),o.debug(s.patient.user),a.isManage=localStorage.getItem("authorizedStatus")>3,o.debug("00000000"+a.isManage),o.debug('typeof getData.patient.user != "undefined"'+("undefined"!=typeof s.patient.data.user)),"undefined"!=typeof s.patient.data.user&&1!=a.isManage){o.debug("00000000");for(var h=0;h<s.patient.data.user.length;h++)for(var b=0;b<s.patient.data.user[h].member.length;b++)if("undefined"!=typeof s.patient.data.user[h].member[b].tag){o.debug("typeof $scope.data.user[i].member[j].tag "),o.debug("undefined"!=typeof s.patient.data.user[h].member[b].tag);for(var S=0;S<s.patient.data.user[h].member[b].tag.length;S++){if(3==s.patient.data.user[h].member[b].tag[S].tagType){s.patient.data.user[h].member[b].isBlack=!0,o.debug("$scope.data.user[i].member[j].isBlack"),o.debug(s.patient.data.user[h].member[b].isBlack);break}s.patient.data.user[h].member[b].isBlack=!1}}else s.patient.data.user[h].member[b].isBlack=!1;for(var h=0;h<s.patient.data.user.length;h++)s.patient.data.user[h].isNull=!1;for(var h=0;h<s.patient.data.user.length;h++)for(var b=0;b<s.patient.data.user[h].member.length;b++){var I=0;1==s.patient.data.user[h].member[b].isBlack&&(I+=1,o.debug("flag"+I),o.debug("$scope.data.user[i].member.length"+s.patient.data.user[h].member.length),I==s.patient.data.user[h].member.length&&(s.patient.data.user[h].isNull=!0))}o.debug("$scope.data.user"),o.debug(s.patient.data.user)}o.debug("$scope.patientData"),a.patientData=s.patient.data.user,o.debug(a.patientData);for(var h=0;h<a.allNursesData.length;h++)a.allNursesData[h].nurseId==localStorage.globalNurseId&&a.allNursesData.splice(h,1);for(var h=0;h<a.nurseData.length;h++){for(var b=0;b<a.nurseData[h].member.length;b++)if(a.nurseData[h].member[b].nurseId==localStorage.globalNurseId){a.nurseData[h].member.splice(b,1);break}0===a.nurseData[h].member.length&&a.nurseData.splice(h,1)}if(a.nurseLength=0,a.patientLength=0,a.memberLength=0,a.isNurseShow=!0,"undefined"!=typeof a.nurseData){a.nurseLength=a.allNursesData.length;for(var h=0;h<a.nurseData.length;h++)a.nurseData[h].memberNum=a.nurseData[h].member.length}if("undefined"!=typeof a.patientData)for(var b=0;b<a.patientData.length;b++)a.patientLength+=a.patientData[b].member.length;a.switchActive=function(t){a.isNurseShow=t},a.allCheckNurse=function(){a.open=!a.open},a.openClose=function(t){t.open=!t.open},a.allCheck=function(t){t.sel=2==t.sel?0:2;for(var e=0;e<t.member.length;e++)t.member[e].sel=2==t.sel},a.allNurseCheck=function(){a.allSel=!a.allSel;for(var t=0;t<a.allNursesData.length;t++)a.allNursesData[t].sel=a.allSel},a.checkSelf=function(t,e){e.sel=!e.sel;for(var a=!0,r=!0,o=0;o<t.member.length;o++)t.member[o].sel===!1?a=!1:r=!1;a===!0?t.sel=2:r===!0?t.sel=0:t.sel=1},a.checkAllSelf=function(t){t.sel=!t.sel;for(var e=!0,r=0;r<a.allNursesData.length;r++){if(a.allNursesData[r].sel!==!0){e=!1;break}e=!0}a.allSel=e},a.patientAllCheck=function(t){t.sel=2==t.sel?0:2;for(var e=0;e<t.length;e++)for(var a=0;a<t[e].member.length;a++)t[e].member[a].sel=2==t.sel},a.checkPatientSelf=function(t,e){e.sel=!e.sel;for(var a=!0,r=!0,o=0;o<t.length;o++)for(var n=0;n<t[o].member.length;n++)t[o].member[n].sel===!1?a=!1:r=!1;a===!0?t.sel=2:r===!0?t.sel=0:t.sel=1},a.setCommunicate=function(){m.show();var t=[],e=[],r=[];if("undefined"!=typeof a.nurseData){for(var n=0;n<a.nurseData.length;n++)for(var s=0;s<a.nurseData[n].member.length;s++)a.nurseData[n].member[s].sel===!0&&1!=a.nurseData[n].member[s].isBlack&&(t.push(a.nurseData[n].member[s]),e.push(a.nurseData[n].member[s]));for(var l=0;l<a.allNursesData.length;l++)a.allNursesData[l].sel===!0&&(t.push(a.allNursesData[l]),e.push(a.allNursesData[l]))}if("undefined"!=typeof a.patientData)for(var i=0;i<a.patientData.length;i++)for(var c=0;c<a.patientData[i].member.length;c++)a.patientData[i].member[c].sel===!0&&1!=a.patientData[i].member[c].isBlack&&(t.push(a.patientData[i].member[c]),r.push(a.patientData[i].member[c]));for(var h=t,n=0;n<h.length;n++)void 0!=h[n].userId&&(h.splice(n,1),n=n-1<0?0:n-1);for(var b,S=[],I=0;I<h.length;I++){b=!0;for(var v=0;v<S.length;v++)if(h[I].nurseId==S[v].nurseId){b=!1;break}b&&S.push(h[I])}for(var l=0;l<r.length;l++)S.push(r[l]);for(var y,C=[],T=0;T<e.length;T++){y=!0;for(var w=0;w<C.length;w++)if(e[T].nurseId==C[w].nurseId){y=!1;break}y&&C.push(e[T])}return t=S,e=C,console.log("---0000"),console.log(t),console.log(e),0===t.length?(d.show("请选择沟通对象"),m.hide(),!1):(o.debug("resultArr.length "+t.length),void(t.length>1?(m.hide(),u.show({title:"请输入群聊名称",msg:'<input class="h3 border-line border-color-global-base padding-left-md" style="width:80%" type="text">',callback:function(){m.show();var t=$(".confirm").find("input").val();a.groupName=t;var o=[],n=[];if(e.length>0)for(var s=0;s<e.length;s++)o.push(e[s].nurseId);if(o.push(localStorage.globalNurseId),r.length>0)for(var l=0;l<r.length;l++)n.push(r[l].userId);g({method:"POST",url:p.getUrl("createGroupChat"),data:{groupName:a.groupName,nurseIds:o,userIds:n}}).success(function(t){"undefined"!=typeof t.result.success&&m.hide(),t.result.success===!0?localStorage.targetChatId=t.groupId:d.show(t.result.displayMsg.toString()),f()})},confirmText:"确定",cancelText:"取消"})):g({method:"POST",url:p.getUrl("nurse"==t[0].type?"createC2CNurse":"createC2CUser",{fromId:localStorage.globalNurseId,toId:"nurse"==t[0].type?t[0].nurseId:t[0].userId})}).success(function(t){"undefined"!=typeof t.result.success&&m.hide(),t.result.success===!0?localStorage.targetChatId=t.toAccount.identifier:d.show(t.result.displayMsg.toString()),f()})))}}]),app.controller("setOrderStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$navbar","$$tabbar","getData","$stateParams",function(t,e,a,r,o,n,s,l,i,c){switch(a.data=i.data,o.debug("setOrderStateController"),o.info(a),c.operateType){case"new":n.setTitle("创建班次");break;default:n.setTitle("修改班次")}s.showReturnBtn(),l.setIndex(-1)}]),app.controller("setTemplateStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$stateParams","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l,i){switch(s.operateType){case"new":n.setTitle("新建随访模板");break;default:n.setTitle("编辑随访模板")}l.setIndex(-1),i.showReturnBtn(),o.debug("setTemplateStateController"),o.info(a)}]),app.controller("settingStateController",["$http","$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$confirm","$$requestUrl","$$toast",function(t,e,a,r,o,n,s,l,i,c,u,d){n.info(r),s.setTitle("设置"),l.setIndex(-1),i.showReturnBtn(),r.nurseStatus=parseInt(localStorage.authorizedStatus),r.exitSign=function(){c.show({title:"退出提示",msg:"确定退出吗？",callback:function(){t({method:"POST",url:u.getUrl("signOut")}).success(function(t){return 1==t.result.success?(d.show("退出成功！"),localStorage.clear(),localStorage.guided="true",location.href=location.origin+location.pathname+"?#/login"):d.show(t.result.display),t})},confirmText:"确定",cancelText:"取消"})}}]),app.controller("sortStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l){o.debug("sortStateController"),o.info(a),n.setTitle("排班"),s.setIndex(-1),l.showReturnBtn()}]),app.controller("startVisitStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar",function(t,e,a,r,o,n,s,l){o.debug("startVisitStateController"),o.info(a),n.setTitle("发起随访"),l.show(),s.setIndex(-1),l.showReturnBtn()}]),app.controller("statisticStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i){l.setTitle("统计管理"),s.setIndex(-1),l.showReturnBtn();for(var c=echarts.init(document.getElementById("userEChart")),u=[],d=[],g=a.data.seven,p=0;p<g.date.length;p++)u.push(g.date[p].substr(5,5));for(p=0;p<g.times.length-1;p++)d.push(g.times[p]);d.push({value:g.times[g.times.length-1],symbolSize:8,label:{normal:{textStyle:{fontSize:15,color:"#FF585C"}}},itemStyle:{normal:{color:"#FF585C",borderWidth:50}}}),option={tooltip:{trigger:"axis",show:!1},grid:{left:"7%",right:"10%",bottom:"15%",top:"15%",show:!1,containLabel:!1},xAxis:[{type:"category",boundaryGap:!1,axisTick:{show:!0},data:u,axisLine:{show:!0,lineStyle:{width:1,color:"#ddd"}},axisLabel:{margin:10,textStyle:{fontSize:13}}}],yAxis:[{type:"value",splitNumber:3,splitLine:{show:!1},axisLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1}}],textStyle:{fontSize:12,color:"#888"},series:[{type:"line",smooth:!0,symbol:"circle",symbolSize:6,data:d,itemStyle:{normal:{color:"#00BD8F"}},label:{normal:{show:!0,formatter:"+{c}人",position:[-12,-18]}}}]},c.setOption(option)}]),app.controller("statisticsCountStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence","$stateParams",function(t,e,a,r,o,n,s,l,i,c){l.showReturnBtn(),s.hide(),a.type=c.statisticType,n.setTitle("plan"==a.type?"康复计划阅读统计":"康复工具使用统计")}]),app.controller("tagManageStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i){o.debug("tagManageStateController"),o.info(a),l.setTitle("标签管理"),l.show(),s.setIndex(-1),l.showReturnBtn()}]),app.controller("toolListStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","$$navbar","$$shence",function(t,e,a,r,o,n,s,l,i){o.debug("toolListStateController"),o.info(a),i.track("_toolListStateController"),l.setTitle("工具"),l.show(),s.setIndex(2),l.hideReturnBtn(),followPatientObj=[],templateObj={},runNurseObjArr={},templateTime="",globalTemplateData={},classArr=[],orderObjArr=[],remindArr=[],admissionTime=null,sortType="new"}]);var headImgUrl="";app.controller("userCenterStateController",["$rootScope","$state","$scope","$location","$$log","$http","$$requestUrl","$$title","getData","$$tabbar","$$confirm","$$toast","$$navbar","$$getClientInfo",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){a.data=i.data,"undefined"!=typeof a.data.basic.departmentId&&""!=a.data.basic.departmentId?localStorage.globalDepartmentId=a.data.basic.departmentId:o.debug("localStorage.globalDepartmentId is null"),"undefined"!=typeof a.data.basic.departmentName&&""!=a.data.basic.departmentName?localStorage.department=a.data.basic.departmentName:o.debug("localStorage.department is null"),"undefined"!=typeof a.data.basic.organizationName&&""!=a.data.basic.organizationName?localStorage.hospital=a.data.basic.organizationName:o.debug("localStorage.hospital is null"),"undefined"!=typeof a.data.basic.organizationId&&""!=a.data.basic.organizationId?localStorage.hospitalId=a.data.basic.organizationId:o.debug("localStorage.hospitalId is null"),"undefined"!=typeof a.data.basic.avatarUrl&&(headImgUrl=a.data.basic.avatarUrl),localStorage.getItem("gloalIsGetDeviceID")||n({method:"POST",url:s.getUrl("createDeviceClient"),data:{personId:localStorage.globalNurseId,cid:p.clientid}}).success(function(t){0==t.result.success?localStorage.gloalIsGetDeviceID=!1:localStorage.gloalIsGetDeviceID=!0}),o.debug("headImgUrl:"+headImgUrl),o.debug("userCenterStateController"),o.info(a.data),o.info(a),l.setTitle("我的"),c.setIndex(3),g.hideReturnBtn()}]),app.controller("writeRecordStateController",["$rootScope","$state","$scope","$location","$$log","$$title","$$tabbar","getData","$$toast","$$navbar","$stateParams",function(t,e,a,r,o,n,s,l,i,c,u){a.data=l.data,a.eventId=u.eventId,o.debug("writeRecordStateController"),o.info(a),n.setTitle("填写记录"),s.setIndex(-1),c.showReturnBtn()}]),app.config(["$stateProvider","$urlMatcherFactoryProvider","$urlRouterProvider","$httpProvider","$locationProvider","$sceProvider",function(t,e,a,r,o,n){o.html5Mode(!0),r.interceptors.push("$$timestampMarker"),n.enabled(!0),e.caseInsensitive(!0),void 0==localStorage.guided||"true"!=localStorage.guided?a.otherwise("/guidePage"):void 0==localStorage.token||""==localStorage.token?a.otherwise("/fakeMainPage"):a.otherwise("/messageTag"),t.state("inputConfirmDemo",{url:"/inputConfirmDemo",controller:"inputConfirmDemo",template:"",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$q",function(t,e,a,r,o){o.all({first:t({method:"GET",url:r.getUrl("registerStateController"),params:{}}),second:t({method:"GET",url:r.getUrl("demo",{id1:1,id2:2}),params:{}})}).then(function(t){a.debug("debug"),a.info(t)})}]}}).state("setOrder",{url:"/:operateType/setOrder",controller:"setOrderStateController",templateUrl:"templates/state/setOrderState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return"new"==e.operateType?(a.debug("new setOrder"),{}):t({method:"GET",url:r.getUrl("createNurseScheduleStateController"),params:{}}).success(function(t){return a.debug("setOrderStateController"),a.info(t),t})}]}}).state("sort",{url:"/:operateType/sort",controller:"sortStateController",templateUrl:"templates/state/sortState.html"}).state("setTemplate",{url:"/:operateType/setTemplate",controller:"setTemplateStateController",templateUrl:"templates/state/setTemplateState.html"}).state("startVisit",{url:"/:operateType/startVisit",controller:"startVisitStateController",templateUrl:"templates/state/startVisitState.html"}).state("editVisit",{url:"/:operateType/editVisit",controller:"editVisitStateController",templateUrl:"templates/state/editVisitState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("createFollowUpTemplatesStateController"),params:{}}).success(function(t){return a.debug("editVisitStateController"),a.info(t),t})}]}}).state("choiceClass",{url:"/:operateType/choiceClass",controller:"choiceClassStateController",templateUrl:"templates/state/choiceClassState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("chooseNurseScheduleStateController"),params:{}}).success(function(t){return a.debug("choiceClassStateController"),a.info(t),t})}]}}).state("classList",{url:"/classList",controller:"classListStateController",templateUrl:"templates/state/classListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("NurseScheduleListStateController"),params:{}}).success(function(t){return a.debug("classListStateController"),a.info(t),t})}]}}).state("choiceVisit",{url:"/:operateType/choiceVisit",controller:"choiceVisitStateController",templateUrl:"templates/state/choiceVisitState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("chooseFollowUpTemplatesStateController"),params:{}}).success(function(t){return a.debug("choiceVisitStateController"),a.info(t),t})}]}}).state("writeRecord",{url:"/:eventId/writeRecord",controller:"writeRecordStateController",templateUrl:"templates/state/writeRecordState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("getFollowUpRecord",{id:e.eventId}),params:{}}).success(function(t){return a.debug("writeRecordStateController"),a.info(t),t})}]}}).state("dutyCalendar",{url:"/dutyCalendar/:weekOffset",controller:"dutyCalendarStateController",templateUrl:"templates/state/dutyCalendarState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return(void 0==e.weekOffset||0==e.weekOffset)&&localStorage.changeSchedulePersonStateController&&+new Date-+JSON.parse(localStorage.changeSchedulePersonStateController).time<3e5?{data:JSON.parse(localStorage.changeSchedulePersonStateController).date}:t({method:"GET",url:r.getUrl("changeSchedulePersonStateController",{departmentId:localStorage.globalDepartmentId}),params:{dateFrom:e.weekOffset||0}}).success(function(t){if(a.debug("dutyCalendarStateController"),a.info(t),1==t.result.success&&(void 0==e.weekOffset||0==e.weekOffset)){var r={time:+new Date,date:t};localStorage.changeSchedulePersonStateController=JSON.stringify(r)}return t})}]}}).state("dutyChange",{url:"/dutyChange/:weekOffset",controller:"dutyChangeStateController",templateUrl:"templates/state/dutyChangeState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return(void 0==e.weekOffset||0==e.weekOffset)&&localStorage.changeScheduleClassStateController&&+new Date-+JSON.parse(localStorage.changeScheduleClassStateController).time<3e5?{data:JSON.parse(localStorage.changeScheduleClassStateController).date}:t({method:"GET",url:r.getUrl("changeScheduleClassStateController",{departmentId:localStorage.globalDepartmentId}),params:{dateFrom:e.weekOffset||0}}).success(function(t){if(a.debug("dutyChangeStateController"),a.info(t),1==t.result.success&&(void 0==e.weekOffset||0==e.weekOffset)){var r={time:+new Date,date:t};localStorage.changeScheduleClassStateController=JSON.stringify(r)}return t})}]}}).state("dutyList",{url:"/dutyList/:weekOffset",controller:"dutyListStateController",templateUrl:"templates/state/dutyListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return(void 0==e.weekOffset||0==e.weekOffset)&&localStorage.batchSchedulesStateController&&+new Date-+JSON.parse(localStorage.batchSchedulesStateController).time<3e5?{data:JSON.parse(localStorage.batchSchedulesStateController).date}:t({method:"GET",url:r.getUrl("batchSchedulesStateController",{departmentId:localStorage.globalDepartmentId}),params:{dateFrom:e.weekOffset||0}}).success(function(t){if(a.debug("dutyListStateController"),a.info(t),1==t.result.success&&(void 0==e.weekOffset||0==e.weekOffset)){var r={time:+new Date,date:t};localStorage.batchSchedulesStateController=JSON.stringify(r)}return t})}]}}).state("choiceColor",{url:"/choiceColor",controller:"choiceColorStateController",templateUrl:"templates/state/choiceColorState.html"}).state("choiceDay",{url:"/choiceDay",controller:"choiceDayStateController",templateUrl:"templates/state/choiceDayState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("chooseRemindTimeStateController"),params:{}}).success(function(t){return a.debug("choiceDayStateController"),a.info(t),t})}]}}).state("choiceHospital",{url:"/choiceHospital",controller:"choiceHospitalStateController",templateUrl:"templates/state/choiceHospitalState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("choiceHospitalStateController"),params:{}}).success(function(t){return a.debug("choiceHospitalStateController"),a.info(t),t})}]}}).state("choiceDepartment",{url:"/:hospitalId/choiceDepartment",controller:"choiceDepartmentStateController",templateUrl:"templates/state/choiceDepartmentState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("choiceDepartmentStateController"),params:{}}).success(function(t){return a.debug("choiceDepartmentStateController"),a.info(t),t})}]}}).state("nurseToolCounter",{url:"/nurseToolCounter",controller:"nurseToolCounterStateController",templateUrl:"templates/nurseMaster/state/nurseToolCounterState.html",
resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$state",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("nurseToolCounterStateController"),params:{}}).success(function(t){return a.debug("nurseToolCounterStateController"),a.info(t),t}).error(function(){o.go("nurseLogin")})}]}}).state("manage",{url:"/manage",controller:"manageStateController",templateUrl:"templates/state/manageState.html"}).state("nursePlanCounter",{url:"/nursePlanCounterStateController",controller:"nursePlanCounterStateController",templateUrl:"templates/state/nursePlanCounterState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$state",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("nursePlanCounterStateController"),params:{}}).success(function(t){return a.debug("nursePlanCounterStateController"),a.info(t),t}).error(function(){o.go("nurseLogin")})}]}}).state("login",{url:"/login",controller:"loginStateController",templateUrl:"templates/state/loginState.html"}).state("basicInfo",{url:"/basicInfo",controller:"basicInfoStateController",templateUrl:"templates/state/basicInfoState.html"}).state("professionInfo",{url:"/professionInfo",controller:"professionInfoStateController",templateUrl:"templates/state/professionInfoState.html"}).state("allPatientList",{url:"/:operateType/allPatientList",controller:"allPatientListStateController",templateUrl:"templates/state/allPatientListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return localStorage.allPatientList&&+new Date-+JSON.parse(localStorage.allPatientList).time<3e5?{data:JSON.parse(localStorage.allPatientList).date}:t({method:"GET",url:r.getUrl("allPatientListStateController",{nurseId:localStorage.globalNurseId}),params:{}}).success(function(t){if(a.debug("allPatientListStateController"),a.info(t),1==t.result.success){var e={time:+new Date,date:t};localStorage.allPatientList=JSON.stringify(e)}return t})}]}}).state("otherPatientList",{url:"/:isIn/otherPatientList",controller:"otherPatientListStateController",templateUrl:"templates/state/otherPatientListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("otherPatientListStateController",{nurseId:localStorage.globalNurseId}),params:{}}).success(function(t){return a.debug("otherPatientListStateController"),a.info(t),t})}]}}).state("patientDetail",{url:"/:patientId/patientDetail",controller:"patientDetailStateController",templateUrl:"templates/state/patientDetailState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("patientDetailStateController",{userId:e.patientId}),params:{}}).success(function(t){return a.debug("patientDetailStateController"),a.info(t),t})}]}}).state("inviteNurse",{url:"/inviteNurse",controller:"inviteNurseStateController",templateUrl:"templates/state/inviteNurseState.html"}).state("userCenter",{url:"/userCenter",controller:"userCenterStateController",templateUrl:"templates/state/userCenterState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("userCenterInfoStateController",{nurseId:localStorage.globalNurseId}),params:{}}).success(function(t){return 0==t.result.success&&o.show(t.result.displayMsg),a.debug("userCenterInfoStateController"),a.info(t),t})}]}}).state("aletrNurseInfo",{url:"/aletrNurseInfo",controller:"aletrNurseInfoStateController",templateUrl:"templates/state/aletrNurseInfoState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("alterNurseInfoStateController",{nurseId:localStorage.globalNurseId}),params:{}}).success(function(t){return 0==t.result.success&&o.show(t.result.displayMsg),a.debug("alterNurseInfoStateController"),a.info(t),t})}]}}).state("nurseList",{url:"/:operateType/nurseList",controller:"nurseListStateController",templateUrl:"templates/state/nurseListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return localStorage.nurseList&&+new Date-+JSON.parse(localStorage.nurseList).time<3e5?{data:JSON.parse(localStorage.nurseList).date}:t({method:"GET",url:r.getUrl("nurseListStateController",{nurseId:localStorage.globalNurseId}),params:{}}).success(function(t){if(0==t.result.success&&o.show(t.result.displayMsg),a.debug("nurseListStateController"),a.info(t),1==t.result.success){var e={time:+new Date,date:t};localStorage.nurseList=JSON.stringify(e)}return t})}]}}).state("nurseDetail",{url:"/:nurseId/nurseDetail",controller:"nurseDetailStateController",templateUrl:"templates/state/nurseDetailState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("nurseDetailStateController",{nurseId:e.nurseId}),params:{}}).success(function(t){return 0==t.result.success&&o.show(t.result.displayMsg),a.debug("nurseDetailStateController"),a.info(t),t})}]}}).state("alterNurseTag",{url:"/:nurseId/alterNurseTag",controller:"alterNurseTagStateController",templateUrl:"templates/state/alterNurseTagState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("alterNurseTagStateController",{departmentId:localStorage.globalDepartmentId}),params:{}}).success(function(t){return 0==t.result.success&&o.show(t.result.displayMsg),a.debug("alterNurseTagStateController"),a.info(t),t})}]}}).state("toolList",{url:"/toolList",controller:"toolListStateController",templateUrl:"templates/state/toolListState.html"}).state("contentList",{url:"/:operateType/contentList",controller:"contentListStateController",templateUrl:"templates/state/contentListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return localStorage.contentListStateController&&+new Date-+JSON.parse(localStorage.contentListStateController).time<36e5?{data:JSON.parse(localStorage.contentListStateController).date}:t({method:"GET",url:r.getUrl("contentListStateController"),params:{}}).success(function(t){if(0==t.result.success&&o.show(t.result.displayMsg),a.debug("contentListStateController"),a.info(t),1==t.result.success){var e={time:+new Date,date:t};localStorage.contentListStateController=JSON.stringify(e)}return t})}]}}).state("patientTag",{url:"/:operateType/patientTag",controller:"patientTagStateController",templateUrl:"templates/state/patientTagState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$$toast",function(t,e,a,r,o){return t({method:"GET",url:r.getUrl("patientTagStateController",{departmentId:localStorage.globalDepartmentId}),params:{}}).success(function(t){return 0==t.result.success&&o.show(t.result.displayMsg),a.debug("patientTagStateController"),a.info(t),t})}]}}).state("selectList",{url:"/selectList",controller:"selectListStateController",templateUrl:"templates/state/selectListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl","$q",function(t,e,a,r,o){return localStorage.selectList&&+new Date-+JSON.parse(localStorage.selectList).time<3e5?JSON.parse(localStorage.selectList):o.all({nurse:t({method:"GET",url:r.getUrl("getSelectNurseStateController",{nurseId:localStorage.globalNurseId}),params:{}}),patient:t({method:"GET",url:r.getUrl("getSelectPatientStateController",{nurseId:localStorage.globalNurseId}),params:{}})}).then(function(t){if(a.debug("debug"),a.info(t),1==t.nurse.data.result.success&&1==t.patient.data.result.success){var e=t;e.time=+new Date,localStorage.selectList=JSON.stringify(e)}return t})}]}}).state("tagManage",{url:"/tagManage",controller:"tagManageStateController",templateUrl:"templates/state/tagManageState.html"}).state("patientTagManage",{url:"/patientTagManage",controller:"patientTagManageStateController",templateUrl:"templates/state/patientTagManageState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("patientTagManageStateController",{departmentId:localStorage.globalDepartmentId}),params:{}}).success(function(t){return a.debug("patientTagManageStateController"),a.info(t),t})}]}}).state("nurseTagManage",{url:"/nurseTagManage",controller:"nurseTagManageStateController",templateUrl:"templates/state/nurseTagManageState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("nurseTagManageStateController",{departmentId:localStorage.globalDepartmentId}),params:{}}).success(function(t){return a.debug("nurseTagManageStateController"),a.info(t),t})}]}}).state("messageTag",{url:"/messageTag",controller:"messageTagStateController",templateUrl:"templates/state/messageTagState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("messageTagStateController"),params:{scenario:"messageCenter"}}).success(function(t){return a.debug("messageTagStateController"),a.info(t),t})}]}}).state("recentCalender",{url:"/recentCalender",controller:"recentCalenderStateController",templateUrl:"templates/state/recentCalenderState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("recentCalenderStateController"),params:{scenario:"messageCenter"}}).success(function(t){return a.debug("recentCalenderStateController"),a.info(t),t})}]}}).state("chat",{url:"/chat",controller:"chatStateController",templateUrl:"templates/state/chatState.html"}).state("createCalender",{url:"/createCalender",controller:"createCalenderStateController",templateUrl:"templates/state/createCalenderStateController.html"}).state("guidePage",{url:"/guidePage",controller:"guidePageStateController",templateUrl:"templates/state/guidePageState.html"}).state("fakeMainPage",{url:"/fakeMainPage",controller:"fakeMainPageStateController",templateUrl:"templates/state/fakeMainPageState.html"}).state("patientRelation",{url:"/patientRelation",controller:"patientRelationStateController",templateUrl:"templates/state/patientRelationState.html"}).state("setting",{url:"/setting",controller:"settingStateController",templateUrl:"templates/state/settingState.html"}).state("blackList",{url:"/blackList",controller:"blackListStateController",templateUrl:"templates/state/blackListState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("blackList",{nurseId:localStorage.globalNurseId}),params:{}}).success(function(t){return a.debug("allPatientListStateController"),a.info(t),t})}]}}).state("statistic",{url:"/statistic",controller:"statisticStateController",templateUrl:"templates/state/statisticState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("statisticStateController"),params:{nurseId:localStorage.globalNurseId}}).success(function(t){return a.debug("statisticStateController"),a.info(t),t})}]}}).state("planCount",{url:"/:statisticType/planCount",controller:"statisticsCountStateController",templateUrl:"templates/state/statisticsCountState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("planCountStateController"),params:{nurseId:localStorage.globalNurseId}}).success(function(t){return a.debug("planCountStateController"),a.info(t),t})}]}}).state("toolCount",{url:"/:statisticType/toolCount",controller:"statisticsCountStateController",templateUrl:"templates/state/statisticsCountState.html",resolve:{getData:["$http","$stateParams","$$log","$$requestUrl",function(t,e,a,r){return t({method:"GET",url:r.getUrl("toolCountStateController"),params:{nurseId:localStorage.globalNurseId}}).success(function(t){return a.debug("toolCountStateController"),a.info(t),t})}]}})}]);var imLoaded="false";app.run(["$rootScope","$window","$location","$$log","$$env","$$initRem","$$wx","$$shence","$$loading","$$navbar","$state","$$txIM","$$tabbar","$timeout",function(t,e,a,r,o,n,s,l,i,c,u,d,g,p){function m(t,e){if(("allPatientList"==e.name||"toolList"==e.name)&&"false"==imLoaded){for(var a={onMsgNotify:function(t){for(var e=0;e<t.length;e++)s(t[e])}},o=d.loadList(),n=0;n<o.length;n++)"empty"!=o[n].lastMsg.type&&o[n].lastMsg.newMsg===!0&&p(function(){g.setNewMsg(0,!0)},2e3);var s=function(t){var e=d.createMsgEle(t);return!!e&&void g.setNewMsg(0,!0)};d.login(a,function(){imLoaded="true",d.sendIMArray()})}r.debug("stateChangeStart"),r.info(arguments,3),r.info(e),l.track("__page_"+e.name,{name:e.name,url:e.url,pre:sessionStorage.prePage}),sessionStorage.prePage=e.name,i.show()}function f(t){r.debug("stateChangeSuccess"),r.info(arguments,3),i.hide()}function h(t){r.debug("locationChangeStart"),r.info(arguments,3)}function $(t){r.debug("locationChangeSuccess"),r.info(arguments,3),i.hide()}r.showAll(!0),l.init(),o.setEnvirement("pro"),n.init(),t.$on("$locationChangeStart",h),t.$on("$locationChangeSuccess",$),t.$on("$stateChangeStart",m),t.$on("$stateChangeSuccess",f)}]);